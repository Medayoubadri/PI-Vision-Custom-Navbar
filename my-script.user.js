// ==UserScript==
// @name          PI Vision Custom Dropdown Menu
// @namespace     https://github.com/Medayoubadri/PI-Vision-Custom-Navbar
// @version       0.9.1
// @description   A custom navbar menu for PI Vision
// @author        MEDAYOUBADRI
// @updateURL     https://raw.githubusercontent.com/Medayoubadri/PI-Vision-Custom-Navbar/main/my-script.user.js
// @downloadURL   https://raw.githubusercontent.com/Medayoubadri/PI-Vision-Custom-Navbar/main/my-script.user.js
// @match         *://pimining.ocpgroup.ma/PIVision/*
// @grant         GM_addStyle
// @run-at        document-start
// ==/UserScript==

(function () {
  "use strict";

  // =================================================================
  // PART 1: UTILITIES (The "Life Easiers")
  // =================================================================

  // Master class name used to activate full screen styles
  const FULLSCREEN_CLASS = "piv-fullscreen-active";

  function waitForElement(selector) {
    return new Promise((resolve) => {
      // Check immediately
      const element = document.querySelector(selector);
      if (element) {
        return resolve(element);
      }
      // Use MutationObserver if element is not yet present
      const observer = new MutationObserver((mutations) => {
        const foundElement = document.querySelector(selector);
        if (foundElement) {
          observer.disconnect();
          resolve(foundElement);
        }
      });
      observer.observe(document.body, {
        childList: true,
        subtree: true,
      });
    });
  }

  /**
   * Toggles the full screen UI mode by applying a class to the body,
   * which triggers CSS rules to hide UI elements and resize containers.
   * @param {string} mode - The desired action ('hide-all', 'custom-select').
   */
  function toggleFullScreenMode(mode) {
    const body = document.body;

    // Locate the "Masquer Tout" submenu item
    const hideAllButton = document.querySelector(
      '.piv-fullscreen-submenu a[data-mode="hide-all"]'
    );

    if (!hideAllButton) return;

    const icon = hideAllButton.querySelector("i");
    const label = hideAllButton.querySelector("span");

    // 1. Placeholder action (no fullscreen toggle)
    if (mode === "custom-select") {
      alert(
        "Selection Personnalis√©e: Cette fonctionnalit√© est en cours de d√©veloppement."
      );
      return;
    }

    // 2. Toggle fullscreen class
    const isActive = body.classList.toggle(FULLSCREEN_CLASS);

    // 3. Update label + icon based on state
    if (isActive) {
      label.textContent = "Afficher Tout";
      icon.classList.remove("fa-eye");
      icon.classList.add("fa-eye-slash");
    } else {
      label.textContent = "Masquer Tout";
      icon.classList.remove("fa-eye-slash");
      icon.classList.add("fa-eye");
    }
  }

  // Load Font Awesome Icons
  function loadFontAwesome() {
    if (document.getElementById("piv-fontawesome")) return;

    const link = document.createElement("link");
    link.id = "piv-fontawesome";
    link.rel = "stylesheet";
    link.href =
      "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css";
    link.crossOrigin = "anonymous";
    document.head.appendChild(link);
  }

  // =================================================================
  // PART 2: THE MENU CONTENT & STYLES
  // =================================================================

  // üèÜ Menus and Submenus
  const menuData = [
    {
      title: "Commun",
      items: [
        {
          text: "Supply Chain Overview",
          hash: "#/Displays/11150/Vue-Globale-Supply-Chain",
          icon: "fa-solid fa-diagram-project",
        },
        {
          text: "Vue Globale Pipeline",
          hash: "#/Displays/305/Vue-Globale-Pipeline",
          icon: "fa-solid fa-route",
        },
        {
          text: "Etat de marche globale",
          hash: "#/Displays/10953/Etat-Marche-Globale-Pipeline",
          icon: "fa-solid fa-gauge-high",
        },
        {
          text: "Pipeline Overview",
          hash: "#/Displays/11134/Pipeline-Overview_KH-JORF",
          icon: "fa-solid fa-network-wired",
        },
        {
          text: "Pipeline Consommation Electrique",
          hash: "#/Displays/11149/Pipe-Consommation-Electrique",
          icon: "fa-solid fa-bolt",
        },
        {
          text: "Suivi des Batchs Pipeline",
          hash: "#/Displays/10949/Suivi-des-Batchs-Pipeline",
          icon: "fa-solid fa-layer-group",
        },
        {
          text: "Tonnage",
          hash: "#/Displays/10938/Tonnage",
          icon: "fa-solid fa-weight-scale",
        },
        {
          text: "Heure de marche",
          hash: "#/Displays/11164/Heure-de-Marche_PIPE",
          icon: "fa-solid fa-clock",
        },
        {
          text: "Etat shunt globale",
          hash: "#/Displays/10955/Etat-SHUNT-Globale",
          icon: "fa-solid fa-toggle-on",
        },
        {
          text: "Liens Utiles",
          icon: "fa-paperclip",
          children: [
            {
              text: "Intranet",
              url: "http://intranet/",
              icon: "fa-building",
            },
            {
              text: "MyDev",
              url: "https://mydev.ocpgroup.ma/my.policy",
              icon: "fa-code",
            },
            {
              text: "Salamaty",
              url: "https://salamaty.ocpgroup.ma/",
              icon: "fa-heart-pulse",
            },
            {
              text: "ISE",
              url: "https://ise.ocpgroup.ma/SitePages/ISE.aspx",
              icon: "fa-flask",
            },
            {
              text: "SAP Fiori",
              url: "https://prods4fiori.ocpgroup.ma/sap/bc/ui2/flp#Shell-home",
              icon: "fa-boxes-stacked",
            },
            {
              text: "HSE",
              url: "https://myops.ocpgroup.ma/HSE/CODIR/Index",
              icon: "fa-helmet-safety",
            },
            {
              text: "SharePoint Pipeline",
              url: "https://eocp.sharepoint.com/sites/IAMaintenancePipeline/SitePages/CollabHome.aspx?market=fr-FR",
              icon: "fa-cloud",
            },
          ],
        },
      ],
    },
    {
      title: "Station T√™te",
      items: [
        {
          text: "Mainline Overview",
          hash: "#/Displays/11151/HS-Mainline-Overview",
          icon: "fa-solid fa-road",
        },
        {
          text: "Vue Op√©rationnelle",
          hash: "#/Displays/10961/Vue-Operationnelle_HS",
          icon: "fa-solid fa-eye",
        },
        {
          text: "Etat de simulation",
          hash: "#/Displays/11101/Etat-Simulation_Head-Station",
          icon: "fa-solid fa-flask",
        },
        {
          text: "Feeders & Storage Tanks",
          hash: "#/Displays/11188/Feeders_Storage-Tanks_HS",
          icon: "fa-solid fa-warehouse",
        },
        {
          text: "Courbes courant/debits",
          hash: "#/Displays/10947/HS-Pompe-Etanchite-(GSW)",
          icon: "fa-solid fa-chart-column",
        },
        {
          text: "Contr√¥le D'√©nergie",
          hash: "#/Displays/11192/Controle-Energie_HS",
          icon: "fa-solid fa-bolt",
        },
        {
          text: "Pompes d'√©tanchit√©",
          icon: "fa-solid fa-water",
          children: [
            {
              text: "Etat de marche GSW",
              hash: "#/Displays/11156/HS-GSW",
              icon: "fa-solid fa-power-off",
            },
            {
              text: "Courbes Pompe GSW",
              hash: "#/Displays/10947/Station-Tete-PERONI-(GSW)",
              icon: "fa-solid fa-chart-line",
            },
            {
              text: "Maintenance pr√©dictive",
              url: "https://maintenance-pompes-stg.apps.techlab.ocpgroup.ma/",
              icon: "fa-solid fa-brain",
            },
          ],
        },
        {
          text: "Maintenance",
          icon: "fa-solid fa-screwdriver-wrench",
          children: [
            {
              text: "Train A",
              hash: "#/Displays/11157/Maintenance_HS-Train-A",
              icon: "fa-solid fa-train",
            },
            {
              text: "Train B",
              hash: "#/Displays/10928/Maintenance_HS-Train-B",
              icon: "fa-solid fa-train",
            },
            {
              text: "Reception & Stockage",
              hash: "#/Displays/11158/Maintenance_HS-Reception",
              icon: "fa-solid fa-warehouse",
            },
          ],
        },
      ],
    },
    {
      title: "Station Daoui",
      items: [
        {
          text: "Daoui Overview",
          hash: "#/Displays/11163/DAOUI-Station_Overview",
          icon: "fa-solid fa-road",
        },
        {
          text: "Vue Op√©rationnelle",
          hash: "#/Displays/11023/Daoui-overview",
          icon: "fa-solid fa-eye",
        },
        {
          text: "Maintenance",
          hash: "#/Displays/621/Maintenance-DAOUI",
          icon: "fa-solid fa-check-double",
        },
        {
          text: "Contr√¥le D'√©nergie",
          hash: "#/Displays/11203/Controle-Energie_DA",
          icon: "fa-solid fa-bolt",
        },
        {
          text: "Courbes courant/debits",
          hash: "#/Displays/10936/Station-DAOUI-Pompes-PERONI-(GSW)",
          icon: "fa-solid fa-chart-column",
        },
        {
          text: "D√©tails des Pompes",
          icon: "fa-solid fa-water",
          children: [
            {
              text: "Etat de marche GSW",
              hash: "#/Displays/11051/DAOUI-GSW",
              icon: "fa-solid fa-fan",
            },
            {
              text: "Maintenance pr√©dictive GSW",
              url: "https://maintenance-pompes-stg.apps.techlab.ocpgroup.ma/",
              icon: "fa-solid fa-bars-progress",
            },
          ],
        },
      ],
    },
    {
      title: "Station Beni Amir",
      items: [
        {
          text: "Beni Amir Overview",
          hash: "#/Displays/11154/Beni-Amir_Overview",
          icon: "fa-solid fa-road",
        },
        {
          text: "Vue Op√©rationnelle",
          hash: "#/Displays/11008/BA-Overview",
          icon: "fa-solid fa-eye",
        },
        {
          text: "Maintenance",
          hash: "#/Displays/10944/Maintenance-BENI-AMIR",
          icon: "fa-solid fa-screwdriver-wrench",
        },
        {
          text: "Courbes courant/debits",
          hash: "#/Displays/10946/Station-BENI-AMIR-Pompes_GSW",
          icon: "fa-solid fa-chart-column",
        },
        {
          text: "Contr√¥le D'√©nergie",
          hash: "#/Displays/11197/Controle-Energie_BA",
          icon: "fa-solid fa-bolt",
        },
        {
          text: "D√©tails des Pompes",
          icon: "fa-solid fa-water",
          children: [
            {
              text: "Etat de marche GSW",
              hash: "#/Displays/11155/BENI-AMIR_GSW",
              icon: "fa-solid fa-fan",
            },
            {
              text: "Maintenance pr√©dictive GSW",
              url: "https://maintenance-pompes-stg.apps.techlab.ocpgroup.ma/",
              icon: "fa-solid fa-bars-progress",
            },
          ],
        },
      ],
    },
    {
      title: "Station MEA",
      items: [
        {
          text: "Vue Op√©rationnelle",
          hash: "#/Displays/10960/MEA-Overview",
          icon: "fa-solid fa-eye",
        },
        {
          text: "Feeder Lines",
          hash: "#/Displays/11160/MEA-Feeder-Lines",
          icon: "fa-solid fa-plug-circle-bolt",
        },
      ],
    },
    {
      title: "PMS & S.V",
      items: [
        {
          text: "Vue Op√©rationnelle",
          hash: "#/Displays/11043/PMS-et-station-vanne",
          icon: "fa-solid fa-sliders",
        },
        {
          text: "Vibrations et CVM",
          hash: "#/Displays/60002/SV-Vibrations",
          icon: "fa-solid fa-wave-square",
        },
      ],
    },
    {
      title: "Station Terminal",
      items: [
        {
          text: "Vue Op√©rationnelle",
          hash: "#/Displays/11038/Terminal-Overview",
          icon: "fa-solid fa-eye",
        },
        {
          text: "Clients",
          hash: "#/Displays/11150/Vue-Globale-Supply-Chain",
          icon: "fa-solid fa-users",
        },
      ],
    },
  ];

  // Utility Menu Items
  const utilityMenuItems = [
    {
      text: "Masquer la Barre",
      action: "hide-navbar",
      icon: "fa-eye-slash",
    },
    {
      text: "Mode plein √©cran",
      icon: "fa-expand",
      submenu: [
        {
          text: "Masquer Tout",
          action: "set-fullscreen-mode",
          mode: "hide-all",
          icon: "fa-eye",
        },
        {
          text: "Selection Personnalis√©e",
          action: "set-fullscreen-mode",
          mode: "custom-select",
          icon: "fa-sliders",
        },
      ],
    },
    {
      text: "Couleur de fond",
      action: "open-bg-color-picker",
      icon: "fa-palette",
    },
    {
      text: "Rafraichir la page",
      action: "refresh-page",
      icon: "fa-arrows-rotate",
    },
  ];

  // SVG Logo embedded directly
  const logoSVG = `
    <svg width="317" height="62" viewBox="0 0 317 62" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M145.045 15.7372C133.087 15.7372 121.02 21.0141 121.02 32.7917C121.02 38.3181 123.655 42.839 128.597 45.871C132.767 48.4121 138.481 49.8229 144.678 49.8229C148.623 49.8229 152.458 49.324 156.542 47.96L154.297 42.3947C151.639 43.026 149.324 43.2287 147.329 43.2287C137.624 43.2287 132.042 39.4327 132.042 32.7917C132.042 26.1585 137.897 22.1989 147.305 22.1989C149.168 22.1989 150.938 22.3782 153.206 22.877L156.581 17.5845C152.481 15.9009 148.716 15.7372 145.037 15.7372M95.6472 15.7372C85.1706 15.7372 73.899 21.0609 73.899 32.745C73.899 44.4368 85.1706 49.8463 95.6472 49.8463C106.124 49.8463 117.403 44.4992 117.403 32.745C117.403 20.9907 106.124 15.7372 95.6472 15.7372ZM95.6472 43.8445C89.3176 43.8445 84.9212 39.269 84.9212 32.745C84.9212 26.2131 89.2319 21.6221 95.6472 21.6221C102.07 21.6221 106.373 26.104 106.373 32.745C106.373 39.386 101.953 43.8445 95.6472 43.8445ZM176.163 15.7372C171.353 15.7372 166.769 16.3841 161.718 17.7872V49.3007H172.546V22.1054C173.746 21.9261 174.876 21.8325 175.921 21.8325C178.369 21.8325 186.335 22.3782 186.335 29.4946C186.335 34.6313 181.666 36.9462 177.012 36.9462C176.802 36.9462 176.303 36.9229 175.921 36.9073L173.769 41.4749C175.851 41.7009 176.965 41.7711 178.08 41.7711C187.668 41.7711 197.357 37.7881 197.357 28.9022C197.357 20.8972 188.666 15.7372 176.17 15.7372" fill="#E5F3E7"/>
      <path d="M57.1708 43.8757C60.2421 41.2412 66.3223 36.1903 64.1552 24.3971C64.1318 24.2646 63.937 24.2724 63.9292 24.4049C63.6174 29.066 61.1463 32.0124 59.9771 35.6836C59.9459 35.7928 59.79 35.7694 59.79 35.6525C59.829 32.0903 56.8746 29.3388 56.4225 27.2109C56.3913 27.0862 56.212 27.0862 56.1887 27.2109C55.0584 34.2962 58.3791 39.0743 56.9915 43.7588C56.9604 43.868 57.0851 43.9537 57.1708 43.8757Z" fill="#E5F3E7"/>
      <path d="M62.3232 41.5373C58.6439 45.9568 58.0982 45.6138 54.1227 49.5033C54.0448 49.5891 53.9123 49.4878 53.9746 49.3864C56.6172 45.037 55.0737 41.5295 54.3956 40.0563C54.341 39.9472 54.1851 39.9784 54.1773 40.0953C53.959 44.5226 50.6929 54.336 35.2898 60.3378C34.713 60.5561 34.4402 60.9302 34.487 61.1952C34.487 61.1952 34.4869 61.5538 35.3132 61.5148C39.3355 61.3277 56.0403 57.75 62.4869 41.6386C62.5336 41.5295 62.3933 41.4515 62.3232 41.5373Z" fill="#E5F3E7"/>
      <path d="M31.868 10.9437C30.3089 13.781 28.4147 19.1982 28.0795 20.913H26.5205C26.4504 20.913 26.3958 20.9754 26.4036 21.0377C26.5595 22.9474 30.2544 25.6911 31.7043 26.6966C31.7822 26.7512 31.8835 26.6966 31.8835 26.5953L32.0862 11.0061C32.0862 10.8814 31.9303 10.8346 31.868 10.9437Z" fill="#E5F3E7"/>
      <path d="M32.7332 10.9437C34.3 13.781 36.1865 19.1982 36.5216 20.913H38.0807C38.1508 20.913 38.2054 20.9754 38.2054 21.0377C38.0495 22.9474 34.3468 25.6911 32.8969 26.6966C32.8268 26.7512 32.7254 26.6966 32.7254 26.5953L32.5228 11.0061C32.5228 10.8814 32.6787 10.8346 32.741 10.9437" fill="#E5F3E7"/>
      <path d="M12.77 25.4882C14.9838 27.8578 19.5362 31.3342 21.064 32.176L20.5807 33.6648C20.5651 33.7349 20.5963 33.8051 20.6664 33.8206C22.5217 34.2571 26.2711 31.5836 27.6742 30.5079C27.7444 30.4534 27.721 30.3443 27.6352 30.3131L12.9025 25.3012C12.7934 25.27 12.6921 25.4025 12.7778 25.4882" fill="#E5F3E7"/>
      <path d="M13.0428 24.6618C16.2154 24.0538 21.9448 23.9213 23.6753 24.1396L24.1586 22.6508C24.1742 22.5807 24.2443 22.5495 24.3145 22.5729C26.0762 23.3056 27.5338 27.6861 28.0405 29.3775C28.0639 29.4633 27.9782 29.5412 27.8924 29.5178L13.035 24.8879C12.9181 24.8567 12.9259 24.6852 13.0428 24.6618Z" fill="#E5F3E7"/>
      <path d="M20.6743 48.186C23.6052 46.8142 28.3134 43.5482 29.584 42.3557L30.8468 43.2754C30.9014 43.3144 30.9794 43.2988 31.0183 43.2443C32.0083 41.6074 30.6208 37.2112 30.044 35.5432C30.0128 35.4497 29.8958 35.4419 29.8413 35.5198L20.5418 48.0145C20.4638 48.1081 20.5651 48.2406 20.6743 48.186Z" fill="#E5F3E7"/>
      <path d="M19.9727 47.6795C20.378 44.4682 22.0228 38.9652 22.7633 37.3829L21.4927 36.4631C21.4381 36.4242 21.4303 36.3462 21.4693 36.2917C22.7165 34.8419 27.3156 34.8029 29.0773 34.8419C29.1708 34.8419 29.2176 34.951 29.1631 35.0289L20.1831 47.7575C20.1208 47.8588 19.9571 47.8043 19.9727 47.6873" fill="#E5F3E7"/>
      <path d="M44.652 47.6793C44.2467 44.4601 42.6019 38.9649 41.8692 37.3748L43.132 36.4551C43.1865 36.4161 43.1943 36.3382 43.1553 36.2836C41.9081 34.8338 37.309 34.7948 35.5396 34.8338C35.446 34.8338 35.3992 34.9429 35.4538 35.0209L44.4337 47.7572C44.5039 47.8508 44.6676 47.7962 44.6442 47.6793" fill="#E5F3E7"/>
      <path d="M43.9503 48.1861C41.0272 46.8143 36.319 43.5405 35.0406 42.348L33.7778 43.2677C33.7232 43.3067 33.6453 43.2989 33.6063 43.2365C32.6163 41.5997 34.0038 37.2035 34.5807 35.5355C34.6118 35.4497 34.7288 35.4342 34.7833 35.5121L44.0907 48.0068C44.1608 48.1082 44.0595 48.2407 43.9503 48.1861Z" fill="#E5F3E7"/>
      <path d="M51.5739 24.6618C48.4013 24.0461 42.6719 23.9213 40.9414 24.1318L40.4581 22.643C40.4426 22.5807 40.3646 22.5417 40.3022 22.5651C38.5406 23.3056 37.0829 27.6783 36.5762 29.3698C36.5528 29.4633 36.6386 29.5412 36.7243 29.5101L51.5817 24.8879C51.6986 24.8489 51.6909 24.6852 51.5739 24.6618Z" fill="#E5F3E7"/>
      <path d="M51.839 25.4882C49.633 27.8578 45.0729 31.3342 43.5528 32.176L44.0361 33.6648C44.0517 33.7349 44.0205 33.8051 43.9504 33.8206C42.0951 34.2571 38.3457 31.5836 36.9426 30.5079C36.8724 30.4534 36.8958 30.3443 36.9816 30.3131L51.7143 25.3012C51.8234 25.27 51.9169 25.4025 51.839 25.4882Z" fill="#E5F3E7"/>
      <path d="M52.439 8.69087C51.4802 7.81788 50.0771 7.38917 48.6428 7.24887C48.5181 7.24108 48.3934 7.2021 48.2843 7.14754C45.7665 5.79128 43.0772 4.63768 40.2865 4.00632C40.2787 4.00632 40.2475 3.99853 40.2475 3.99853C40.1774 3.98294 40.115 4.02191 40.0994 4.09206C40.0916 4.15442 40.1306 4.21678 40.193 4.24016C40.193 4.24016 40.2242 4.24016 40.2397 4.24796C43.1863 4.97285 46.125 6.32132 47.8322 7.73993C47.9491 7.83346 48.0348 7.95818 48.0972 8.09848C48.5805 9.25208 49.1183 10.3199 50.0771 11.2007C51.0047 12.0503 52.3143 12.1906 52.9613 11.5047C53.6083 10.8188 53.4836 9.6496 52.4468 8.69087" fill="#E5F3E7"/>
      <path d="M58.2776 19.1434L55.4558 15.5423C53.3278 12.8376 52.3534 13.617 50.7242 13.7028C50.4358 13.7184 50.1552 13.6326 49.9291 13.4534C47.0137 11.0994 43.7398 8.88573 39.4058 7.96597C39.3902 7.96597 39.359 7.95818 39.359 7.95818C39.3044 7.94259 39.2421 7.98156 39.2343 8.03612C39.2187 8.09068 39.2577 8.14525 39.3044 8.15304C39.3044 8.15304 39.5539 8.22319 39.6786 8.25437C43.1864 9.18972 46.1875 10.8811 48.8534 13.5937C53.3122 18.9719 56.2119 18.2782 58.1295 19.3071C58.2387 19.3694 58.3556 19.2369 58.2776 19.1356" fill="#E5F3E7"/>
      <path d="M59.3533 18.6602C58.948 16.4076 59.5404 12.4947 56.7108 9.33012C56.6095 9.19761 56.4458 9.03392 56.2821 8.87024C52.3846 4.66896 47.1852 1.5901 41.0817 0.2884C40.5828 0.187071 40.0839 0.0935355 39.5694 0.00779459C39.5617 0.00779459 39.5383 0 39.5383 0C39.4837 0 39.4291 0.0311778 39.4213 0.0857404C39.4135 0.140301 39.4525 0.194863 39.5071 0.202657C39.5071 0.202657 39.5617 0.210454 39.585 0.218248C40.0683 0.303989 40.5516 0.405319 41.0271 0.506648C46.6552 1.78496 51.418 4.4585 55.1596 8.90921C55.3701 9.16643 55.4324 9.50939 55.3233 9.82118C54.8868 11.006 54.5516 11.9413 55.6663 13.5782C55.9859 14.0614 58.2542 17.4209 59.1429 18.7382C59.213 18.8395 59.3689 18.7772 59.3456 18.6602" fill="#E5F3E7"/>
      <path d="M60.2732 24.4127C60.2732 24.5219 60.1251 24.553 60.0861 24.4517C59.7977 23.719 59.2131 22.5186 58.1919 21.5443C56.9057 20.305 55.4948 20.2114 54.4269 19.2137C54.3411 19.128 54.2008 19.2059 54.2242 19.3229C55.5572 25.6443 59.5093 25.9093 60.0393 29.4792C60.0549 29.5961 60.2186 29.6117 60.2576 29.4948C61.3333 26.2055 65.9792 21.2247 60.1485 13.6718C60.0705 13.5705 59.9068 13.6562 59.9458 13.7809C61.2632 17.7639 60.1874 21.2559 60.2732 24.4127Z" fill="#E5F3E7"/>
      <path d="M7.44605 43.8757C4.37479 41.2412 -1.70537 36.1903 0.453864 24.3971C0.47725 24.2646 0.672125 24.2724 0.687714 24.4049C0.991723 29.066 3.46276 32.0124 4.63202 35.6836C4.6632 35.7928 4.81911 35.7694 4.81911 35.6525C4.78013 32.0903 7.73446 29.3388 8.18658 27.2109C8.22555 27.0862 8.40484 27.0862 8.42043 27.2109C9.55851 34.2962 6.23001 39.0743 7.61754 43.7588C7.64872 43.868 7.53179 43.9537 7.44605 43.8757Z" fill="#E5F3E7"/>
      <path d="M2.29338 41.5373C5.97266 45.9568 6.51052 45.6138 10.486 49.5033C10.5718 49.5891 10.7043 49.4878 10.6419 49.3864C7.99158 45.037 9.53501 41.5295 10.221 40.0563C10.2677 39.9472 10.4236 39.9784 10.4314 40.0953C10.6575 44.5226 13.9236 54.336 29.3189 60.3378C29.8957 60.5561 30.1686 60.9302 30.1218 61.1952C30.1218 61.1952 30.1218 61.5538 29.2955 61.5148C25.2811 61.3277 8.56842 57.75 2.12189 41.6386C2.08292 41.5295 2.22323 41.4515 2.29338 41.5373Z" fill="#E5F3E7"/>
      <path d="M12.1697 8.69087C13.1285 7.81788 14.5394 7.38917 15.9659 7.24887C16.0985 7.24108 16.2154 7.2021 16.3245 7.14754C18.8423 5.79128 21.5394 4.63768 24.3223 4.00632C24.33 4.00632 24.3612 3.99853 24.3612 3.99853C24.4236 3.98294 24.4937 4.02191 24.5093 4.09206C24.5171 4.15442 24.4782 4.21678 24.4158 4.24016C24.4158 4.24016 24.3846 4.24016 24.369 4.24796C21.4225 4.97285 18.4837 6.32132 16.7766 7.73993C16.6597 7.83346 16.5739 7.95818 16.5116 8.09848C16.0283 9.25208 15.4904 10.3199 14.5316 11.2007C13.604 12.0503 12.2945 12.1906 11.6475 11.5047C11.0005 10.8188 11.1252 9.6496 12.1619 8.69087" fill="#E5F3E7"/>
      <path d="M6.33905 19.1434L9.16087 15.5423C11.2889 12.8376 12.2633 13.617 13.8847 13.7028C14.1731 13.7184 14.4537 13.6326 14.6798 13.4534C17.5951 11.0994 20.8691 8.88573 25.2031 7.96597C25.2187 7.96597 25.2577 7.95818 25.2577 7.95818C25.3123 7.94259 25.3668 7.98156 25.3746 8.03612C25.3902 8.09068 25.359 8.14525 25.3045 8.15304C25.3045 8.15304 25.055 8.22319 24.9303 8.25437C21.4225 9.18972 18.4214 10.8811 15.7555 13.5937C11.2967 18.9719 8.40475 18.2782 6.47936 19.3071C6.37803 19.3694 6.2611 19.2369 6.33905 19.1356" fill="#E5F3E7"/>
      <path d="M5.25562 18.6602C5.66096 16.4076 5.06853 12.4947 7.89815 9.33012C8.00728 9.19761 8.16318 9.03392 8.32688 8.87024C12.2322 4.66896 17.4237 1.5901 23.5351 0.2884C24.034 0.187071 24.5328 0.0935355 25.0395 0.00779459C25.0551 0.00779459 25.0785 0 25.0785 0C25.1331 0 25.1798 0.0311778 25.1876 0.0857404C25.1954 0.140301 25.1564 0.194863 25.1019 0.202657C25.1019 0.202657 25.0551 0.210454 25.0317 0.218248C24.5406 0.303989 24.0573 0.405319 23.5818 0.506648C17.9538 1.78496 13.191 4.4585 9.45716 8.90921C9.24669 9.16643 9.18433 9.50939 9.29346 9.82118C9.72999 11.006 10.0652 11.9413 8.95048 13.5782C8.62309 14.0614 6.36251 17.4209 5.47388 18.7382C5.40372 18.8395 5.24002 18.7772 5.26341 18.6602" fill="#E5F3E7"/>
      <path d="M4.66307 13.7809C4.70984 13.6562 4.54615 13.5705 4.4604 13.6718C-1.37032 21.2247 3.27555 26.2133 4.35127 29.5026C4.39024 29.6117 4.55394 29.5961 4.56953 29.4792C5.10739 25.9093 9.05949 25.6443 10.3847 19.3229C10.408 19.2059 10.2677 19.128 10.182 19.2137C9.11406 20.2114 7.71095 20.2972 6.41696 21.5443C5.39581 22.5186 4.81897 23.719 4.52276 24.4517C4.48379 24.553 4.33568 24.5219 4.33568 24.4127C4.42143 21.2559 3.3457 17.7639 4.66307 13.7809Z" fill="#E5F3E7"/>
      <line x1="211.857" y1="15.2589" x2="211.857" y2="46.2589" stroke="#E5F3E7" stroke-width="3" stroke-linecap="round"/>
      <path d="M230.365 25.9269C229.261 25.9269 228.285 25.7349 227.437 25.3509C226.605 24.9669 225.949 24.4309 225.469 23.7429C224.989 23.0549 224.733 22.2869 224.701 21.4389H226.477C226.557 22.2549 226.917 22.9749 227.557 23.5989C228.197 24.2069 229.133 24.5109 230.365 24.5109C231.501 24.5109 232.397 24.2229 233.053 23.6469C233.725 23.0549 234.061 22.3109 234.061 21.4149C234.061 20.6949 233.877 20.1189 233.509 19.6869C233.141 19.2389 232.685 18.9109 232.141 18.7029C231.597 18.4789 230.845 18.2389 229.885 17.9829C228.765 17.6789 227.877 17.3829 227.221 17.0949C226.565 16.8069 226.005 16.3589 225.541 15.7509C225.077 15.1429 224.845 14.3189 224.845 13.2789C224.845 12.4149 225.069 11.6469 225.517 10.9749C225.965 10.2869 226.597 9.75091 227.413 9.36691C228.229 8.98291 229.165 8.79091 230.221 8.79091C231.773 8.79091 233.021 9.17491 233.965 9.94291C234.925 10.6949 235.477 11.6709 235.621 12.8709H233.797C233.685 12.1829 233.309 11.5749 232.669 11.0469C232.029 10.5029 231.165 10.2309 230.077 10.2309C229.069 10.2309 228.229 10.5029 227.557 11.0469C226.885 11.5749 226.549 12.3029 226.549 13.2309C226.549 13.9349 226.733 14.5029 227.101 14.9349C227.469 15.3669 227.925 15.6949 228.469 15.9189C229.029 16.1429 229.781 16.3829 230.725 16.6389C231.813 16.9429 232.693 17.2469 233.365 17.5509C234.037 17.8389 234.605 18.2869 235.069 18.8949C235.533 19.5029 235.765 20.3189 235.765 21.3429C235.765 22.1269 235.557 22.8709 235.141 23.5749C234.725 24.2789 234.109 24.8469 233.293 25.2789C232.477 25.7109 231.501 25.9269 230.365 25.9269ZM246.86 17.0949C247.804 17.2709 248.604 17.7509 249.26 18.5349C249.916 19.3189 250.244 20.2309 250.244 21.2709C250.244 22.1189 250.028 22.8869 249.596 23.5749C249.18 24.2469 248.564 24.7829 247.748 25.1829C246.932 25.5669 245.956 25.7589 244.82 25.7589H239.012V8.98291H244.652C246.348 8.98291 247.636 9.37491 248.516 10.1589C249.412 10.9429 249.86 11.9589 249.86 13.2069C249.86 14.2469 249.58 15.0949 249.02 15.7509C248.46 16.3909 247.74 16.8389 246.86 17.0949ZM240.692 16.3989H244.604C245.74 16.3989 246.612 16.1349 247.22 15.6069C247.844 15.0629 248.156 14.3189 248.156 13.3749C248.156 12.4469 247.844 11.7189 247.22 11.1909C246.612 10.6629 245.716 10.3989 244.532 10.3989H240.692V16.3989ZM244.7 24.3429C245.916 24.3429 246.86 24.0549 247.532 23.4789C248.22 22.9029 248.564 22.1109 248.564 21.1029C248.564 20.0949 248.204 19.2949 247.484 18.7029C246.78 18.0949 245.828 17.7909 244.628 17.7909H240.692V24.3429H244.7ZM254.94 8.98291V19.5429C254.94 21.2069 255.332 22.4389 256.116 23.2389C256.916 24.0389 258.004 24.4389 259.38 24.4389C260.756 24.4389 261.828 24.0469 262.596 23.2629C263.38 22.4629 263.772 21.2229 263.772 19.5429V8.98291H265.452V19.5189C265.452 21.6469 264.884 23.2469 263.748 24.3189C262.628 25.3909 261.164 25.9269 259.356 25.9269C257.548 25.9269 256.076 25.3909 254.94 24.3189C253.82 23.2469 253.26 21.6469 253.26 19.5189V8.98291H254.94ZM244.453 33.8389V50.7589H239.749V41.4229L236.557 50.7589H232.621L229.405 41.3509V50.7589H224.701V33.8389H230.389L234.637 44.8309L238.789 33.8389H244.453ZM251.835 33.8389V50.7589H247.131V33.8389H251.835ZM270.186 50.7589H265.482L259.218 41.3029V50.7589H254.514V33.8389H259.218L265.482 43.4149V33.8389H270.186V50.7589ZM277.569 33.8389V50.7589H272.865V33.8389H277.569ZM295.92 50.7589H291.216L284.952 41.3029V50.7589H280.248V33.8389H284.952L291.216 43.4149V33.8389H295.92V50.7589ZM309.4 39.4069C309.128 38.9589 308.752 38.6149 308.272 38.3749C307.808 38.1349 307.256 38.0149 306.616 38.0149C305.432 38.0149 304.496 38.3989 303.808 39.1669C303.136 39.9349 302.8 40.9669 302.8 42.2629C302.8 43.7189 303.16 44.8309 303.88 45.5989C304.616 46.3509 305.68 46.7269 307.072 46.7269C308.72 46.7269 309.896 45.9829 310.6 44.4949H305.872V41.1109H314.656V45.6709C314.288 46.5669 313.744 47.4069 313.024 48.1909C312.32 48.9749 311.424 49.6229 310.336 50.1349C309.248 50.6309 308.008 50.8789 306.616 50.8789C304.92 50.8789 303.416 50.5189 302.104 49.7989C300.808 49.0629 299.8 48.0469 299.08 46.7509C298.376 45.4389 298.024 43.9429 298.024 42.2629C298.024 40.5989 298.376 39.1189 299.08 37.8229C299.8 36.5109 300.808 35.4949 302.104 34.7749C303.4 34.0389 304.896 33.6709 306.592 33.6709C308.72 33.6709 310.48 34.1829 311.872 35.2069C313.264 36.2309 314.128 37.6309 314.464 39.4069H309.4Z" fill="#E5F3E7"/>
    </svg>
    `;

  const secondaryLogoSVG = `
        <svg
            width="245"
            height="22"
            viewBox="0 0 245 22"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            >
            <path
                d="M10.7 6.50002C10.7 7.31335 10.5133 8.06002 10.14 8.74002C9.76668 9.40669 9.19334 9.94669 8.42001 10.36C7.64668 10.7734 6.68668 10.98 5.54001 10.98H3.42001V16.02H9.81987e-06V1.98002H5.54001C6.66001 1.98002 7.60668 2.17335 8.38001 2.56002C9.15334 2.94669 9.73334 3.48002 10.12 4.16002C10.5067 4.84002 10.7 5.62002 10.7 6.50002ZM5.28001 8.26002C5.93334 8.26002 6.42001 8.10669 6.74001 7.80002C7.06001 7.49335 7.22001 7.06002 7.22001 6.50002C7.22001 5.94002 7.06001 5.50669 6.74001 5.20002C6.42001 4.89335 5.93334 4.74002 5.28001 4.74002H3.42001V8.26002H5.28001ZM14.2005 3.70002C13.6005 3.70002 13.1071 3.52669 12.7205 3.18002C12.3471 2.82002 12.1605 2.38002 12.1605 1.86002C12.1605 1.32669 12.3471 0.886686 12.7205 0.540019C13.1071 0.180018 13.6005 1.83582e-05 14.2005 1.83582e-05C14.7871 1.83582e-05 15.2671 0.180018 15.6405 0.540019C16.0271 0.886686 16.2205 1.32669 16.2205 1.86002C16.2205 2.38002 16.0271 2.82002 15.6405 3.18002C15.2671 3.52669 14.7871 3.70002 14.2005 3.70002ZM15.9005 4.86002V16.02H12.4805V4.86002H15.9005ZM21.7989 6.44002C22.1322 5.92002 22.5922 5.50002 23.1789 5.18002C23.7656 4.86002 24.4522 4.70002 25.2389 4.70002C26.1589 4.70002 26.9923 4.93335 27.7389 5.40002C28.4856 5.86669 29.0722 6.53335 29.4989 7.40002C29.9389 8.26669 30.1589 9.27335 30.1589 10.42C30.1589 11.5667 29.9389 12.58 29.4989 13.46C29.0722 14.3267 28.4856 15 27.7389 15.48C26.9923 15.9467 26.1589 16.18 25.2389 16.18C24.4656 16.18 23.7789 16.02 23.1789 15.7C22.5922 15.38 22.1322 14.9667 21.7989 14.46V21.34H18.3789V4.86002H21.7989V6.44002ZM26.6789 10.42C26.6789 9.56669 26.4389 8.90002 25.9589 8.42002C25.4922 7.92669 24.9122 7.68002 24.2189 7.68002C23.5389 7.68002 22.9589 7.92669 22.4789 8.42002C22.0122 8.91335 21.7789 9.58669 21.7789 10.44C21.7789 11.2934 22.0122 11.9667 22.4789 12.46C22.9589 12.9534 23.5389 13.2 24.2189 13.2C24.8989 13.2 25.4789 12.9534 25.9589 12.46C26.4389 11.9534 26.6789 11.2734 26.6789 10.42ZM42.4731 10.26C42.4731 10.58 42.4531 10.9134 42.4131 11.26H34.6731C34.7265 11.9534 34.9465 12.4867 35.3331 12.86C35.7331 13.22 36.2198 13.4 36.7931 13.4C37.6465 13.4 38.2398 13.04 38.5731 12.32H42.2131C42.0265 13.0534 41.6865 13.7134 41.1931 14.3C40.7131 14.8867 40.1065 15.3467 39.3731 15.68C38.6398 16.0134 37.8198 16.18 36.9131 16.18C35.8198 16.18 34.8465 15.9467 33.9931 15.48C33.1398 15.0134 32.4731 14.3467 31.9931 13.48C31.5131 12.6134 31.2731 11.6 31.2731 10.44C31.2731 9.28002 31.5065 8.26669 31.9731 7.40002C32.4531 6.53335 33.1198 5.86669 33.9731 5.40002C34.8265 4.93335 35.8065 4.70002 36.9131 4.70002C37.9931 4.70002 38.9531 4.92669 39.7931 5.38002C40.6331 5.83335 41.2865 6.48002 41.7531 7.32002C42.2331 8.16002 42.4731 9.14002 42.4731 10.26ZM38.9731 9.36002C38.9731 8.77335 38.7731 8.30669 38.3731 7.96002C37.9731 7.61335 37.4731 7.44002 36.8731 7.44002C36.2998 7.44002 35.8131 7.60669 35.4131 7.94002C35.0265 8.27335 34.7865 8.74669 34.6931 9.36002H38.9731ZM47.6974 1.22002V16.02H44.2774V1.22002H47.6974ZM51.8958 3.70002C51.2958 3.70002 50.8025 3.52669 50.4158 3.18002C50.0425 2.82002 49.8558 2.38002 49.8558 1.86002C49.8558 1.32669 50.0425 0.886686 50.4158 0.540019C50.8025 0.180018 51.2958 1.83582e-05 51.8958 1.83582e-05C52.4825 1.83582e-05 52.9625 0.180018 53.3358 0.540019C53.7225 0.886686 53.9158 1.32669 53.9158 1.86002C53.9158 2.38002 53.7225 2.82002 53.3358 3.18002C52.9625 3.52669 52.4825 3.70002 51.8958 3.70002ZM53.5958 4.86002V16.02H50.1758V4.86002H53.5958ZM62.8742 4.74002C64.1809 4.74002 65.2209 5.16669 65.9942 6.02002C66.7809 6.86002 67.1742 8.02002 67.1742 9.50002V16.02H63.7742V9.96002C63.7742 9.21335 63.5809 8.63335 63.1942 8.22002C62.8076 7.80669 62.2876 7.60002 61.6342 7.60002C60.9809 7.60002 60.4609 7.80669 60.0742 8.22002C59.6876 8.63335 59.4942 9.21335 59.4942 9.96002V16.02H56.0742V4.86002H59.4942V6.34002C59.8409 5.84669 60.3076 5.46002 60.8942 5.18002C61.4809 4.88669 62.1409 4.74002 62.8742 4.74002ZM80.0708 10.26C80.0708 10.58 80.0508 10.9134 80.0108 11.26H72.2708C72.3241 11.9534 72.5441 12.4867 72.9308 12.86C73.3308 13.22 73.8175 13.4 74.3908 13.4C75.2441 13.4 75.8375 13.04 76.1708 12.32H79.8108C79.6241 13.0534 79.2841 13.7134 78.7908 14.3C78.3108 14.8867 77.7041 15.3467 76.9708 15.68C76.2375 16.0134 75.4175 16.18 74.5108 16.18C73.4175 16.18 72.4441 15.9467 71.5908 15.48C70.7375 15.0134 70.0708 14.3467 69.5908 13.48C69.1108 12.6134 68.8708 11.6 68.8708 10.44C68.8708 9.28002 69.1041 8.26669 69.5708 7.40002C70.0508 6.53335 70.7175 5.86669 71.5708 5.40002C72.4241 4.93335 73.4041 4.70002 74.5108 4.70002C75.5908 4.70002 76.5508 4.92669 77.3908 5.38002C78.2308 5.83335 78.8841 6.48002 79.3508 7.32002C79.8308 8.16002 80.0708 9.14002 80.0708 10.26ZM76.5708 9.36002C76.5708 8.77335 76.3708 8.30669 75.9708 7.96002C75.5708 7.61335 75.0708 7.44002 74.4708 7.44002C73.8975 7.44002 73.4108 7.60669 73.0108 7.94002C72.6241 8.27335 72.3841 8.74669 72.2908 9.36002H76.5708ZM94.2533 16.02L89.5333 9.82002V16.02H86.1133V1.98002H89.5333V8.14002L94.2133 1.98002H98.2333L92.7933 8.86002L98.4333 16.02H94.2533ZM106.919 4.74002C108.199 4.74002 109.225 5.16669 109.999 6.02002C110.772 6.86002 111.159 8.02002 111.159 9.50002V16.02H107.759V9.96002C107.759 9.21335 107.565 8.63335 107.179 8.22002C106.792 7.80669 106.272 7.60002 105.619 7.60002C104.965 7.60002 104.445 7.80669 104.059 8.22002C103.672 8.63335 103.479 9.21335 103.479 9.96002V16.02H100.059V1.22002H103.479V6.36002C103.825 5.86669 104.299 5.47335 104.899 5.18002C105.499 4.88669 106.172 4.74002 106.919 4.74002ZM118.615 16.18C117.522 16.18 116.535 15.9467 115.655 15.48C114.788 15.0134 114.102 14.3467 113.595 13.48C113.102 12.6134 112.855 11.6 112.855 10.44C112.855 9.29335 113.108 8.28669 113.615 7.42002C114.122 6.54002 114.815 5.86669 115.695 5.40002C116.575 4.93335 117.562 4.70002 118.655 4.70002C119.748 4.70002 120.735 4.93335 121.615 5.40002C122.495 5.86669 123.188 6.54002 123.695 7.42002C124.202 8.28669 124.455 9.29335 124.455 10.44C124.455 11.5867 124.195 12.6 123.675 13.48C123.168 14.3467 122.468 15.0134 121.575 15.48C120.695 15.9467 119.708 16.18 118.615 16.18ZM118.615 13.22C119.268 13.22 119.822 12.98 120.275 12.5C120.742 12.02 120.975 11.3334 120.975 10.44C120.975 9.54669 120.748 8.86002 120.295 8.38002C119.855 7.90002 119.308 7.66002 118.655 7.66002C117.988 7.66002 117.435 7.90002 116.995 8.38002C116.555 8.84669 116.335 9.53335 116.335 10.44C116.335 11.3334 116.548 12.02 116.975 12.5C117.415 12.98 117.962 13.22 118.615 13.22ZM137.29 4.86002V16.02H133.87V14.5C133.523 14.9934 133.05 15.3934 132.45 15.7C131.863 15.9934 131.21 16.14 130.49 16.14C129.636 16.14 128.883 15.9534 128.23 15.58C127.576 15.1934 127.07 14.64 126.71 13.92C126.35 13.2 126.17 12.3534 126.17 11.38V4.86002H129.57V10.92C129.57 11.6667 129.763 12.2467 130.15 12.66C130.536 13.0734 131.056 13.28 131.71 13.28C132.376 13.28 132.903 13.0734 133.29 12.66C133.676 12.2467 133.87 11.6667 133.87 10.92V4.86002H137.29ZM143.166 6.72002C143.566 6.10669 144.066 5.62669 144.666 5.28002C145.266 4.92002 145.933 4.74002 146.666 4.74002V8.36002H145.726C144.873 8.36002 144.233 8.54669 143.806 8.92002C143.379 9.28002 143.166 9.92002 143.166 10.84V16.02H139.746V4.86002H143.166V6.72002ZM150.021 3.70002C149.421 3.70002 148.927 3.52669 148.541 3.18002C148.167 2.82002 147.981 2.38002 147.981 1.86002C147.981 1.32669 148.167 0.886686 148.541 0.540019C148.927 0.180018 149.421 1.83582e-05 150.021 1.83582e-05C150.607 1.83582e-05 151.087 0.180018 151.461 0.540019C151.847 0.886686 152.041 1.32669 152.041 1.86002C152.041 2.38002 151.847 2.82002 151.461 3.18002C151.087 3.52669 150.607 3.70002 150.021 3.70002ZM151.721 4.86002V16.02H148.301V4.86002H151.721ZM157.619 6.44002C157.939 5.92002 158.399 5.50002 158.999 5.18002C159.599 4.86002 160.286 4.70002 161.059 4.70002C161.979 4.70002 162.813 4.93335 163.559 5.40002C164.306 5.86669 164.893 6.53335 165.319 7.40002C165.759 8.26669 165.979 9.27335 165.979 10.42C165.979 11.5667 165.759 12.58 165.319 13.46C164.893 14.3267 164.306 15 163.559 15.48C162.813 15.9467 161.979 16.18 161.059 16.18C160.273 16.18 159.586 16.0267 158.999 15.72C158.413 15.4 157.953 14.98 157.619 14.46V16.02H154.199V1.22002H157.619V6.44002ZM162.499 10.42C162.499 9.56669 162.259 8.90002 161.779 8.42002C161.313 7.92669 160.733 7.68002 160.039 7.68002C159.359 7.68002 158.779 7.92669 158.299 8.42002C157.833 8.91335 157.599 9.58669 157.599 10.44C157.599 11.2934 157.833 11.9667 158.299 12.46C158.779 12.9534 159.359 13.2 160.039 13.2C160.719 13.2 161.299 12.9534 161.779 12.46C162.259 11.9534 162.499 11.2734 162.499 10.42ZM172.013 4.70002C172.8 4.70002 173.487 4.86002 174.073 5.18002C174.673 5.50002 175.133 5.92002 175.453 6.44002V4.86002H178.873V16C178.873 17.0267 178.667 17.9534 178.253 18.78C177.853 19.62 177.233 20.2867 176.393 20.78C175.567 21.2734 174.533 21.52 173.293 21.52C171.64 21.52 170.3 21.1267 169.273 20.34C168.247 19.5667 167.66 18.5134 167.513 17.18H170.893C171 17.6067 171.253 17.94 171.653 18.18C172.053 18.4334 172.547 18.56 173.133 18.56C173.84 18.56 174.4 18.3534 174.813 17.94C175.24 17.54 175.453 16.8934 175.453 16V14.42C175.12 14.94 174.66 15.3667 174.073 15.7C173.487 16.02 172.8 16.18 172.013 16.18C171.093 16.18 170.26 15.9467 169.513 15.48C168.767 15 168.173 14.3267 167.733 13.46C167.307 12.58 167.093 11.5667 167.093 10.42C167.093 9.27335 167.307 8.26669 167.733 7.40002C168.173 6.53335 168.767 5.86669 169.513 5.40002C170.26 4.93335 171.093 4.70002 172.013 4.70002ZM175.453 10.44C175.453 9.58669 175.213 8.91335 174.733 8.42002C174.267 7.92669 173.693 7.68002 173.013 7.68002C172.333 7.68002 171.753 7.92669 171.273 8.42002C170.807 8.90002 170.573 9.56669 170.573 10.42C170.573 11.2734 170.807 11.9534 171.273 12.46C171.753 12.9534 172.333 13.2 173.013 13.2C173.693 13.2 174.267 12.9534 174.733 12.46C175.213 11.9667 175.453 11.2934 175.453 10.44ZM180.668 10.42C180.668 9.27335 180.881 8.26669 181.308 7.40002C181.748 6.53335 182.341 5.86669 183.088 5.40002C183.834 4.93335 184.668 4.70002 185.588 4.70002C186.374 4.70002 187.061 4.86002 187.648 5.18002C188.248 5.50002 188.708 5.92002 189.028 6.44002V4.86002H192.448V16.02H189.028V14.44C188.694 14.96 188.228 15.38 187.628 15.7C187.041 16.02 186.354 16.18 185.568 16.18C184.661 16.18 183.834 15.9467 183.088 15.48C182.341 15 181.748 14.3267 181.308 13.46C180.881 12.58 180.668 11.5667 180.668 10.42ZM189.028 10.44C189.028 9.58669 188.788 8.91335 188.308 8.42002C187.841 7.92669 187.268 7.68002 186.588 7.68002C185.908 7.68002 185.328 7.92669 184.848 8.42002C184.381 8.90002 184.148 9.56669 184.148 10.42C184.148 11.2734 184.381 11.9534 184.848 12.46C185.328 12.9534 185.908 13.2 186.588 13.2C187.268 13.2 187.841 12.9534 188.308 12.46C188.788 11.9667 189.028 11.2934 189.028 10.44ZM203.522 7.58002V10.42H194.722V7.58002H203.522ZM215.323 1.98002V11.54C215.323 13.02 214.903 14.16 214.063 14.96C213.237 15.76 212.117 16.16 210.703 16.16C209.223 16.16 208.037 15.74 207.143 14.9C206.25 14.06 205.803 12.8667 205.803 11.32H209.203C209.203 11.9067 209.323 12.3534 209.563 12.66C209.803 12.9534 210.15 13.1 210.603 13.1C211.017 13.1 211.337 12.9667 211.563 12.7C211.79 12.4334 211.903 12.0467 211.903 11.54V1.98002H215.323ZM223.166 16.18C222.073 16.18 221.086 15.9467 220.206 15.48C219.339 15.0134 218.653 14.3467 218.146 13.48C217.653 12.6134 217.406 11.6 217.406 10.44C217.406 9.29335 217.659 8.28669 218.166 7.42002C218.673 6.54002 219.366 5.86669 220.246 5.40002C221.126 4.93335 222.113 4.70002 223.206 4.70002C224.299 4.70002 225.286 4.93335 226.166 5.40002C227.046 5.86669 227.739 6.54002 228.246 7.42002C228.753 8.28669 229.006 9.29335 229.006 10.44C229.006 11.5867 228.746 12.6 228.226 13.48C227.719 14.3467 227.019 15.0134 226.126 15.48C225.246 15.9467 224.259 16.18 223.166 16.18ZM223.166 13.22C223.819 13.22 224.373 12.98 224.826 12.5C225.293 12.02 225.526 11.3334 225.526 10.44C225.526 9.54669 225.299 8.86002 224.846 8.38002C224.406 7.90002 223.859 7.66002 223.206 7.66002C222.539 7.66002 221.986 7.90002 221.546 8.38002C221.106 8.84669 220.886 9.53335 220.886 10.44C220.886 11.3334 221.099 12.02 221.526 12.5C221.966 12.98 222.513 13.22 223.166 13.22ZM234.24 6.72002C234.64 6.10669 235.14 5.62669 235.74 5.28002C236.34 4.92002 237.007 4.74002 237.74 4.74002V8.36002H236.8C235.947 8.36002 235.307 8.54669 234.88 8.92002C234.454 9.28002 234.24 9.92002 234.24 10.84V16.02H230.82V4.86002H234.24V6.72002ZM244.975 7.70002H243.135V16.02H239.715V7.70002H238.475V4.86002H239.715V4.54002C239.715 3.16669 240.108 2.12669 240.895 1.42002C241.682 0.700019 242.835 0.340019 244.355 0.340019C244.608 0.340019 244.795 0.346685 244.915 0.360018V3.26002C244.262 3.22002 243.802 3.31335 243.535 3.54002C243.268 3.76669 243.135 4.17335 243.135 4.76002V4.86002H244.975V7.70002Z"
                fill="#27CD72"
            />
        </svg>
    `;
  const sidebarLogoSVG = `
        <svg
            width="35"
            height="360"
            viewBox="0 0 35 360"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            >
            <g clip-path="url(#clip0_86_40)">
                <path
                d="M34.3435 336.751C34.3435 337.039 34.2157 337.23 33.9603 337.326L28.3561 339.05C28.2603 339.082 28.2124 339.146 28.2124 339.242L28.2124 352.701C28.2124 352.797 28.2603 352.861 28.3561 352.893L33.9603 354.617C34.2157 354.713 34.3435 354.905 34.3435 355.192L34.3435 359.072C34.3435 359.423 34.1678 359.551 33.8166 359.455L1.19757 348.965C0.942111 348.87 0.814378 348.678 0.814378 348.391L0.814378 343.601C0.814378 343.313 0.94211 343.122 1.19757 343.026L33.8166 332.44L34.0082 332.392C34.2317 332.392 34.3435 332.536 34.3435 332.824L34.3435 336.751ZM24.3326 351.696C24.3965 351.728 24.4604 351.728 24.5242 351.696C24.5562 351.632 24.5721 351.568 24.5721 351.504L24.5721 340.487C24.5721 340.423 24.5562 340.376 24.5242 340.344C24.4604 340.28 24.3965 340.264 24.3326 340.296L6.56223 345.852C6.49836 345.884 6.46642 345.932 6.46642 345.996C6.46642 346.06 6.49836 346.107 6.56223 346.139L24.3326 351.696ZM34.3435 320.274C34.3435 320.561 34.2157 320.753 33.9603 320.849L1.34125 331.099L1.14967 331.147C0.926139 331.147 0.814377 331.003 0.814377 330.716L0.814377 326.836C0.814377 326.549 0.94211 326.357 1.19757 326.261L27.6855 318.358C27.7494 318.326 27.7813 318.278 27.7813 318.214C27.7813 318.151 27.7494 318.103 27.6855 318.071L1.19757 310.167C0.942109 310.072 0.814376 309.896 0.814376 309.641L0.814376 305.857C0.814376 305.505 0.989989 305.378 1.34125 305.473L33.9603 315.82C34.2157 315.915 34.3435 316.107 34.3435 316.394L34.3435 320.274ZM4.31098 278.219C4.6303 278.219 4.78997 278.379 4.78997 278.698L4.78997 295.702C4.78997 295.83 4.85383 295.894 4.98156 295.894L15.2798 295.894C15.4075 295.894 15.4714 295.83 15.4714 295.702L15.4714 284.015C15.4714 283.695 15.631 283.536 15.9504 283.536L18.968 283.536C19.2873 283.536 19.447 283.695 19.447 284.015L19.447 295.702C19.447 295.83 19.5108 295.894 19.6385 295.894L30.1763 295.894C30.304 295.894 30.3679 295.83 30.3679 295.702L30.3679 278.698C30.3679 278.379 30.5275 278.219 30.8469 278.219L33.8645 278.219C34.1838 278.219 34.3435 278.379 34.3435 278.698L34.3435 300.013C34.3435 300.332 34.1838 300.492 33.8645 300.492L1.29337 300.492C0.974049 300.492 0.814376 300.332 0.814376 300.013L0.814375 278.698C0.814375 278.379 0.974048 278.219 1.29337 278.219L4.31098 278.219ZM34.3435 262.844C34.3435 263.131 34.2157 263.323 33.9603 263.418L1.34124 273.669L1.14966 273.717C0.926137 273.717 0.814375 273.573 0.814375 273.285L0.814375 269.406C0.814375 269.118 0.942107 268.927 1.19757 268.831L27.6855 260.928C27.7494 260.896 27.7813 260.848 27.7813 260.784C27.7813 260.72 27.7494 260.672 27.6855 260.64L1.19757 252.737C0.942106 252.641 0.814374 252.466 0.814374 252.21L0.814374 248.426C0.814374 248.075 0.989987 247.947 1.34124 248.043L33.9603 258.389C34.2157 258.485 34.3435 258.676 34.3435 258.964L34.3435 262.844ZM34.3435 226.776C34.3435 227.063 34.2157 227.255 33.9603 227.351L28.3561 229.075C28.2603 229.107 28.2124 229.171 28.2124 229.267L28.2124 242.726C28.2124 242.822 28.2603 242.886 28.3561 242.918L33.9603 244.642C34.2157 244.738 34.3435 244.929 34.3435 245.217L34.3435 249.097C34.3435 249.448 34.1678 249.576 33.8166 249.48L1.19757 238.99C0.942106 238.894 0.814373 238.703 0.814373 238.415L0.814373 233.625C0.814373 233.338 0.942106 233.146 1.19757 233.051L33.8166 222.465L34.0082 222.417C34.2317 222.417 34.3435 222.561 34.3435 222.848L34.3435 226.776ZM24.3326 241.72C24.3965 241.752 24.4604 241.752 24.5242 241.72C24.5562 241.656 24.5721 241.593 24.5721 241.529L24.5721 230.512C24.5721 230.448 24.5562 230.4 24.5242 230.368C24.4604 230.304 24.3965 230.288 24.3326 230.32L6.56222 235.877C6.49836 235.909 6.46642 235.956 6.46642 236.02C6.46642 236.084 6.49836 236.132 6.56222 236.164L24.3326 241.72ZM0.766468 175.093C0.766468 173.145 1.18158 171.437 2.01182 169.968C2.81013 168.467 3.94375 167.318 5.41264 166.519C6.88154 165.689 8.57394 165.274 10.4899 165.274C12.4058 165.274 14.0823 165.689 15.5193 166.519C16.9562 167.35 18.0739 168.531 18.8722 170.064C19.6705 171.565 20.0696 173.305 20.0696 175.285L20.0696 183.715C20.0696 183.843 20.1335 183.907 20.2612 183.907L33.8645 183.907C34.1838 183.907 34.3435 184.066 34.3435 184.386L34.3435 188.026C34.3435 188.345 34.1838 188.505 33.8645 188.505L1.24547 188.505C0.926141 188.505 0.766468 188.345 0.766468 188.026L0.766468 175.093ZM16.3335 175.716C16.3335 173.96 15.8066 172.555 14.7529 171.501C13.6991 170.415 12.31 169.872 10.5857 169.872C8.82941 169.872 7.42438 170.415 6.37061 171.501C5.28491 172.555 4.74207 173.96 4.74207 175.716L4.74207 183.715C4.74207 183.843 4.80592 183.907 4.93365 183.907L16.1419 183.907C16.2697 183.907 16.3335 183.843 16.3335 183.715L16.3335 175.716ZM34.3434 159.335C34.3434 159.654 34.1838 159.814 33.8645 159.814L1.29337 159.814C0.974043 159.814 0.81437 159.654 0.81437 159.335L0.81437 155.694C0.81437 155.375 0.974043 155.215 1.29337 155.215L33.8645 155.215C34.1838 155.215 34.3434 155.375 34.3434 155.694L34.3434 159.335ZM34.3434 129.302C34.3434 129.589 34.2157 129.781 33.9603 129.877L1.34124 140.127L1.14966 140.175C0.926131 140.175 0.814369 140.031 0.814369 139.744L0.814369 135.864C0.814369 135.577 0.942101 135.385 1.19756 135.289L27.6855 127.386C27.7494 127.354 27.7813 127.306 27.7813 127.242C27.7813 127.179 27.7494 127.131 27.6855 127.099L1.19756 119.195C0.942101 119.1 0.814368 118.924 0.814368 118.669L0.814368 114.885C0.814368 114.533 0.989981 114.406 1.34124 114.501L33.9603 124.847C34.2157 124.943 34.3434 125.135 34.3434 125.422L34.3434 129.302ZM6.13112 106.79C6.13112 107.684 5.84372 108.418 5.26893 108.993C4.69415 109.568 3.9597 109.855 3.06559 109.855C2.17148 109.855 1.43705 109.568 0.86227 108.993C0.287486 108.418 8.05461e-05 107.684 8.0507e-05 106.79C8.04679e-05 105.896 0.287486 105.161 0.86227 104.586C1.43705 104.012 2.17148 103.724 3.06559 103.724C3.9597 103.724 4.69415 104.012 5.26893 104.586C5.84372 105.161 6.13112 105.896 6.13112 106.79ZM34.2955 108.706C34.2955 109.025 34.1359 109.185 33.8165 109.185L10.442 109.185C10.1227 109.185 9.96301 109.025 9.96301 108.706L9.96301 105.065C9.96301 104.746 10.1227 104.586 10.442 104.586L33.8165 104.586C34.1359 104.586 34.2955 104.746 34.2955 105.065L34.2955 108.706ZM34.6308 88.7798C34.6308 90.6957 34.3434 92.3881 33.7686 93.857C33.1939 95.294 32.4115 96.4116 31.4216 97.2099C30.3998 98.0082 29.2821 98.4074 28.0687 98.4074L27.5418 98.4074C27.2225 98.4074 27.0628 98.2477 27.0628 97.9284L27.0628 94.4797C27.0628 94.1604 27.2225 94.0007 27.5418 94.0007L27.7813 94.0007C28.6754 94.0007 29.4578 93.5218 30.1284 92.5638C30.7989 91.5739 31.1342 90.3285 31.1342 88.8277C31.1342 87.3907 30.8309 86.2252 30.2241 85.3311C29.5855 84.437 28.7872 83.9899 27.8292 83.9899C26.9032 83.9899 26.2166 84.405 25.7696 85.2353C25.2906 86.0655 24.7956 87.4067 24.2847 89.2588C23.7738 91.0789 23.2629 92.6117 22.752 93.857C22.2091 95.0705 21.4587 96.1083 20.5007 96.9704C19.5108 97.8007 18.2495 98.2158 16.7167 98.2158C14.5773 98.2158 12.8848 97.3856 11.6395 95.7251C10.3622 94.0327 9.72353 91.7974 9.72353 89.0193C9.72353 87.1672 10.0269 85.5386 10.6336 84.1336C11.2084 82.6967 12.0227 81.595 13.0764 80.8286C14.1302 80.0622 15.3117 79.679 16.6209 79.679L16.7646 79.679C17.084 79.679 17.2436 79.8387 17.2436 80.158L17.2436 83.5109C17.2436 83.8302 17.084 83.9899 16.7646 83.9899L16.6209 83.9899C15.6949 83.9899 14.9285 84.4529 14.3218 85.379C13.6832 86.2731 13.3638 87.5025 13.3638 89.0672C13.3638 90.4722 13.6352 91.6218 14.1781 92.5159C14.7209 93.3781 15.4554 93.8091 16.3814 93.8091C17.3075 93.8091 18.01 93.394 18.489 92.5638C18.968 91.7016 19.4789 90.3285 20.0217 88.4445C20.5326 86.5924 21.0436 85.0596 21.5545 83.8462C22.0335 82.6008 22.7679 81.5471 23.7578 80.6849C24.7158 79.8227 25.9771 79.3916 27.5418 79.3916C29.7132 79.3916 31.4376 80.2538 32.7149 81.9782C33.9922 83.6706 34.6308 85.9378 34.6308 88.7798ZM6.13112 71.2489C6.13112 72.143 5.84372 72.8774 5.26893 73.4522C4.69415 74.027 3.95969 74.3144 3.06559 74.3144C2.17148 74.3144 1.43705 74.027 0.862269 73.4522C0.287485 72.8774 7.89926e-05 72.143 7.89535e-05 71.2489C7.89144e-05 70.3547 0.287485 69.6203 0.862269 69.0455C1.43705 68.4707 2.17148 68.1834 3.06559 68.1834C3.95969 68.1834 4.69415 68.4707 5.26893 69.0455C5.84372 69.6203 6.13112 70.3547 6.13112 71.2489ZM34.2955 73.1648C34.2955 73.4841 34.1359 73.6438 33.8165 73.6438L10.442 73.6438C10.1227 73.6438 9.96301 73.4841 9.96301 73.1648L9.96301 69.5245C9.96301 69.2052 10.1227 69.0455 10.442 69.0455L33.8165 69.0455C34.1359 69.0455 34.2955 69.2052 34.2955 69.5245L34.2955 73.1648ZM34.7266 51.8499C34.7266 54.2129 34.1359 56.2726 32.9544 58.0288C31.741 59.7851 30.0645 61.0145 27.925 61.717C26.2007 62.2918 24.2528 62.5792 22.0814 62.5792C19.8142 62.5792 17.8982 62.3078 16.3335 61.7649C14.226 61.0624 12.5815 59.833 11.4 58.0767C10.1865 56.3204 9.57982 54.2289 9.57982 51.802C9.57982 49.5029 10.1865 47.5071 11.4 45.8147C12.5815 44.0903 14.21 42.8609 16.2856 42.1265C17.9142 41.5517 19.8301 41.2643 22.0335 41.2643C24.2688 41.2643 26.2326 41.5517 27.925 42.1265C30.0645 42.829 31.741 44.0424 32.9544 45.7667C34.1359 47.4911 34.7266 49.5188 34.7266 51.8499ZM30.751 51.8499C30.751 50.5726 30.3998 49.455 29.6973 48.497C28.9628 47.539 27.941 46.8525 26.6318 46.4374C25.4183 46.0861 23.9175 45.9105 22.1293 45.9105C20.341 45.9105 18.8562 46.0701 17.6747 46.3895C16.3655 46.8046 15.3596 47.4911 14.6571 48.4491C13.9226 49.4071 13.5554 50.5726 13.5554 51.9457C13.5554 53.2549 13.9226 54.3885 14.6571 55.3465C15.3596 56.3045 16.3655 56.991 17.6747 57.4061C18.7923 57.7574 20.2772 57.933 22.1293 57.933C23.9813 57.933 25.4822 57.7574 26.6318 57.4061C27.941 57.0229 28.9628 56.3524 29.6973 55.3944C30.3998 54.4045 30.751 53.223 30.751 51.8499ZM9.62772 24.356C9.62772 21.7376 10.3941 19.662 11.9268 18.1292C13.4277 16.5965 15.4714 15.8301 18.0579 15.8301L33.8644 15.8301C34.1838 15.8301 34.3434 15.9897 34.3434 16.3091L34.3434 19.9494C34.3434 20.2687 34.1838 20.4284 33.8644 20.4284L18.9679 20.4284C17.3713 20.4284 16.0781 20.8914 15.0882 21.8174C14.0982 22.7435 13.6033 23.9729 13.6033 25.5056C13.6033 27.0064 14.0982 28.2358 15.0882 29.1938C16.0781 30.1518 17.3554 30.6308 18.92 30.6308L33.8644 30.6308C34.1838 30.6308 34.3434 30.7904 34.3434 31.1098L34.3434 34.7501C34.3434 35.0694 34.1838 35.229 33.8644 35.229L10.442 35.229C10.1227 35.229 9.96301 35.0694 9.96301 34.7501L9.96301 31.1098C9.96301 30.7904 10.1227 30.6308 10.442 30.6308L12.1664 30.6308C12.2302 30.6308 12.2781 30.6148 12.31 30.5829C12.342 30.519 12.326 30.4711 12.2621 30.4392C10.5058 29.0661 9.62772 27.0384 9.62772 24.356Z"
                fill="white"
                />
                <path
                d="M2.59293 220.228C2.59293 220.388 2.5131 220.467 2.35344 220.467L1.6589 220.467C1.49923 220.467 1.4194 220.388 1.4194 220.228L1.4194 214.48C1.4194 214.32 1.49923 214.241 1.6589 214.241L2.35344 214.241C2.5131 214.241 2.59293 214.32 2.59293 214.48L2.59293 216.635C2.59293 216.699 2.62486 216.731 2.68873 216.731L9.58621 216.731C9.74587 216.731 9.82573 216.811 9.82573 216.971L9.82573 217.833C9.82573 217.993 9.74587 218.072 9.58621 218.072L2.68873 218.072C2.62486 218.072 2.59293 218.104 2.59293 218.168L2.59293 220.228ZM1.5631 207.463C1.46731 207.399 1.4194 207.303 1.4194 207.175L1.4194 206.313C1.4194 206.153 1.49923 206.074 1.6589 206.074L9.58604 206.074C9.7457 206.074 9.82553 206.153 9.82553 206.313L9.82553 207.175C9.82553 207.335 9.7457 207.415 9.58604 207.415L3.74232 207.415C3.69442 207.415 3.6625 207.431 3.64653 207.463C3.63069 207.495 3.64664 207.518 3.69441 207.534L5.87383 208.971C5.96963 209.051 6.01753 209.147 6.01753 209.259L6.01753 209.498C6.01753 209.626 5.96963 209.722 5.87383 209.786L3.69441 211.247C3.64651 211.263 3.63056 211.287 3.64653 211.318C3.66237 211.35 3.6943 211.366 3.74232 211.366L9.58604 211.366C9.7457 211.366 9.82553 211.446 9.82553 211.606L9.82553 212.468C9.82553 212.628 9.7457 212.708 9.58604 212.708L1.6589 212.708C1.49923 212.708 1.4194 212.628 1.4194 212.468L1.4194 211.582C1.4194 211.454 1.46731 211.358 1.56311 211.295L4.29336 209.474C4.3092 209.458 4.3171 209.434 4.3171 209.403C4.3171 209.371 4.3092 209.347 4.29336 209.331L1.5631 207.463Z"
                fill="white"
                stroke="white"
                stroke-width="0.37716"
                />
                <path
                d="M2.9701 13.9215C2.9701 14.0812 2.89027 14.161 2.73061 14.161L2.03606 14.161C1.8764 14.161 1.79657 14.0812 1.79657 13.9215L1.79657 8.17363C1.79657 8.01396 1.8764 7.93413 2.03606 7.93413L2.73061 7.93413C2.89027 7.93413 2.9701 8.01396 2.9701 8.17363L2.9701 10.3291C2.9701 10.393 3.00203 10.4249 3.06589 10.4249L9.96338 10.4249C10.123 10.4249 10.2029 10.5047 10.2029 10.6644L10.2029 11.5266C10.2029 11.6862 10.123 11.7661 9.96338 11.7661L3.06589 11.7661C3.00203 11.7661 2.9701 11.798 2.9701 11.8619L2.9701 13.9215ZM1.94027 1.1562C1.84447 1.09233 1.79657 0.996522 1.79657 0.868791L1.79657 0.00660549C1.79657 -0.153059 1.8764 -0.232889 2.03606 -0.232889L9.9632 -0.232889C10.1229 -0.232889 10.2027 -0.153059 10.2027 0.00660512L10.2027 0.86879C10.2027 1.02845 10.1229 1.1083 9.9632 1.1083L4.11949 1.1083C4.07159 1.1083 4.03966 1.12426 4.0237 1.1562C4.00786 1.18813 4.0238 1.21208 4.07158 1.22805L6.251 2.66503C6.3468 2.74486 6.3947 2.84065 6.3947 2.95242L6.3947 3.19191C6.3947 3.31964 6.3468 3.41544 6.251 3.4793L4.07158 4.94024C4.02368 4.95633 4.00773 4.98028 4.0237 5.01209C4.03954 5.04402 4.07146 5.05998 4.11949 5.05998L9.9632 5.05998C10.1229 5.05998 10.2027 5.13981 10.2027 5.29948L10.2027 6.16166C10.2027 6.32133 10.1229 6.40116 9.9632 6.40116L2.03606 6.40116C1.8764 6.40116 1.79657 6.32133 1.79657 6.16166L1.79657 5.27554C1.79657 5.14781 1.84447 5.052 1.94027 4.98813L4.67053 3.16796C4.68637 3.15186 4.69427 3.12793 4.69427 3.09612C4.69427 3.06419 4.68637 3.04023 4.67053 3.02427L1.94027 1.1562Z"
                fill="white"
                stroke="white"
                stroke-width="0.37716"
                />
            </g>
            <defs>
                <clipPath id="clip0_86_40">
                <rect
                    width="359.486"
                    height="34.8"
                    fill="white"
                    transform="translate(3.05176e-05 359.486) rotate(-90)"
                />
                </clipPath>
            </defs>
        </svg>
    `;

  /**
   * Recursively renders menu items (items, submenus, external links)
   * @param {Array} items
   * @returns {string}
   */
  function renderMenuItems(items) {
    return items
      .map((item) => {
        // -------------------------
        // EXTERNAL LINK
        // -------------------------
        if (item.url) {
          return `
          <a href="${item.url}"
             target="_blank"
             rel="noopener noreferrer"
             class="piv-menu-item">
            <i class="fa-solid ${item.icon} piv-icon"></i>
            <span>${item.text}</span>
          </a>
        `;
        }

        // -------------------------
        // NESTED SUBMENU
        // -------------------------
        if (item.children && item.children.length) {
          return `
          <div class="piv-menu-wrapper">
            <div class="piv-menu-item piv-submenu-title">
              <i class="fa-solid ${item.icon} piv-icon"></i>
              <span>${item.text}</span>
              <i class="fa-solid fa-chevron-right piv-arrow-right"></i>
            </div>

            <div class="piv-nested-submenu">
              ${renderMenuItems(item.children)}
            </div>
          </div>
        `;
        }

        // -------------------------
        // INTERNAL PI VISION LINK
        // -------------------------
        return `
        <a href="${item.hash}"
           data-hash="${item.hash}"
           class="piv-menu-item">
          <i class="fa-solid ${item.icon} piv-icon"></i>
          <span>${item.text}</span>
        </a>
      `;
      })
      .join("");
  }

  /**
   * Generates ONE top-level dropdown menu
   * @param {Object} menu
   * @param {number} index
   * @returns {string}
   */
  function generateDropdownHTML(menu, index) {
    const sanitizedId = menu.title.replace(/[^a-zA-Z0-9]/g, "_");

    return `
    <div class="piv-dropdown-item-container" data-id="${sanitizedId}">
      <button class="piv-dropbtn">
        ${menu.title}
        <i class="fa-solid fa-chevron-down piv-arrow"></i>
      </button>

      <div class="piv-dropdown-content">
        ${renderMenuItems(menu.items)}
      </div>
    </div>

    ${index < menuData.length - 1 ? '<div class="piv-menu-divider"></div>' : ""}
  `;
  }

  // Function to show a live date and time.
  function formatFrenchDateTime(date) {
    const datePart = new Intl.DateTimeFormat("fr-FR", {
      weekday: "long",
      day: "2-digit",
      month: "long",
    }).format(date);

    const timePart = new Intl.DateTimeFormat("en-US", {
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      hour12: true,
    }).format(date);

    return `${
      datePart.charAt(0).toUpperCase() + datePart.slice(1)
    } - ${timePart}`;
  }

  // Function to generate the utility dropdown HTML (No changes here, it's the model for the main menu)
  function generateUtilityDropdown() {
    const utilityItemsHTML = utilityMenuItems
      .map((item) => {
        // ITEM WITH SUBMENU (Mode plein √©cran)
        if (item.submenu) {
          const submenuItemsHTML = item.submenu
            .map((subItem) => {
              return `
                    <a href="#"
                       class="piv-utility-item piv-submenu-item"
                       data-action="${subItem.action}"
                       data-mode="${subItem.mode}">
                        <i class="fa-solid ${subItem.icon} piv-icon"></i>
                        <span>${subItem.text}</span>
                    </a>
                `;
            })
            .join("");

          return `
                <div class="piv-utility-menu-wrapper">
                    <a href="#"
                       class="piv-utility-item piv-has-nested"
                       data-action="${item.action}">
                        <i class="fa-solid ${item.icon} piv-icon"></i>
                        <span>${item.text}</span>
                        <i class="fa-solid fa-chevron-right piv-arrow-right"></i>
                    </a>

                    <div class="piv-fullscreen-submenu">
                        ${submenuItemsHTML}
                    </div>
                </div>
            `;
        }

        // STANDARD UTILITY ITEM (Masquer / Rafraichir)
        return `
            <a href="#"
               class="piv-utility-item"
               data-action="${item.action}">
                <i class="fa-solid ${item.icon} piv-icon"></i>
                <span>${item.text}</span>
            </a>
        `;
      })
      .join("");

    return `
        <div class="piv-dropdown-item-container piv-utility-container">
            <button class="piv-dropbtn piv-utility-btn">
                <img class="piv-btn-cog" src="/PIVision/Images/Settings64x64.png"/>
            </button>
            <div class="piv-dropdown-content piv-utility-content">
                ${utilityItemsHTML}
            </div>
        </div>
    `;
  }

  // ‚û°Ô∏è Define the main HTML structure for the entire header
  const customMenuHTML = `
        <div id="piv-custom-header" class="piv-custom-header-bar">
            <div class="piv-logo-container">
               <a class="piv-ocp-logo" href="https://pimining.ocpgroup.ma/PIVision/#/">
                  ${logoSVG}
                 </a>
           </div>
            <div class="piv-menu-bar">
                ${menuData.map(generateDropdownHTML).join("")}
            </div>
            <div class="piv-utility-wrapper">
                ${generateUtilityDropdown()}
            </div>
        </div>
    `;

  // ‚û°Ô∏è Define the custom CSS styles (UPDATED for main menu nested submenus)
  const customMenuCSS = `
        /* Main Header Bar */
        .piv-custom-header-bar {
            position: relative;
            height: 36px;
            background-color: linear-gradient(to right,#072c50 0,#091d3a 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-family: 'Poppins', Arial, sans-serif;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }

        /* Styles for the minimized/hidden bar */
        .piv-custom-header-bar.piv-minimized {
            height: 55px;
            padding: 7px 15px;
            width: auto;
            right: 0px;
            left: auto;
            border-radius: 12px 0 0 12px;
            justify-self: end;
        }

        /* Secondary logo styles */
        .piv-secondary-logo {
            display: inline-flex;
            align-items: center;
            margin-right: 10px;
        }

        .piv-sidebar-logo {
            display: flex;
            margin-bottom: 20px;
            margin-left: 20px;
            align-items: flex-end;
            position: absolute;
            height: fit-content !important;
            width: fit-content !important;
            left: 0;
            bottom: 0;
            z-index: 999;
        }

        .piv-sidebar-logo svg {
            height: 160px;
            width: auto;
        }

        /* Live Date and time styles */
        .piv-live-date {
            display: flex;
            font-size: 16px;
            font-weight: 500;
            color: #ffffffcc;
            letter-spacing: 0.3px;
            white-space: nowrap;
            font-family: 'Poppins', Arial, sans-serif;
            justify-content: center;
            align-items: center;
        }

        .piv-secondary-logo svg {
            height: 24px;
            width: auto;
        }

        /* Hide the main menu and logo when minimized */
        .piv-custom-header-bar.piv-minimized .piv-logo-container,
        .piv-custom-header-bar.piv-minimized .piv-menu-bar {
            display: none !important;
        }

        /* Replace PI Vision logo */
        .c-app-logo a {
            display: none !important;
        }

        /* Logo Styling */
        .piv-logo-container {
            padding: 0 10px;
            height: 100%;
            display: flex;
            align-items: center;
            overflow: hidden;
        }
        .piv-ocp-logo svg {
            height: 40px;
            width: auto;
        }

        .piv-aveva-logo img {
             width: 130px !important;
             margin-left: 10px;
             margin-top: 4px;
             height: 25px !important;
        }

        /* Menu Bar Container */
        .piv-menu-bar {
            display: flex;
            flex-grow: 1;
            height: 100%;
            align-items: stretch;
            justify-content: center; /* Center the main menu items */
            margin: 0 20px;
        }

        /* Vertical Divider */
        .piv-menu-divider {
            width: 2px;
            background-color: rgb(255 255 255 / 30%);
            margin: 18px 10px;
            border-radius: 50px;
        }

        /* Individual Dropdown Container */
        .piv-dropdown-item-container {
            position: relative;
            display: flex;
            text-align: center;
            align-items: center;
            justify-content: center;
            /* Allow menu items to shrink/grow slightly */
            flex-shrink: 1;
            flex-grow: 0;
        }

        /* Dropdown Button (Title) */
        .piv-dropbtn {
            display: flex;
            align-items: center;
            background-color: transparent;
            color: white;
            padding-inline: 16px;
            font-size: 14px;
            font-weight: 600;
            line-height: 50px;
            height: 100%;
            border: none;
            cursor: pointer;
            outline: none;
            border-radius: 10px;
            transition: background-color 0.3s ease;
            white-space: nowrap;
        }

        /* Ensure utility button height adjusts when minimized */
        .piv-custom-header-bar.piv-minimized .piv-utility-container .piv-dropbtn {
            line-height: 30px;
        }


        /* Active State Fix */
        .piv-dropbtn:hover,
        .piv-dropdown-item-container.active .piv-dropbtn,
        #sidebar-pane tool-tabs>ul>li.k-item.k-state-default:hover {
            background-color: rgba(255, 255, 255, 0.15) !important;
        }

        /* Dropdown Content */
        .piv-dropdown-content {
            visibility: hidden;
            padding: 5px;
            opacity: 0;
            position: absolute;
            top: 110%;
            left: 0;
            background-color: #ffffffd4;
            backdrop-filter: blur(10px);
            max-width: 300px;
            box-shadow: 6px 24px 30px 0px rgb(0 0 0 / 20%);
            z-index: 100000000 !important;
            border-radius: 12px;
            border-top: 1px solid #ffffff7d;
            border-bottom: 3px solid #2a3e5d;
            transform: translateY(-10px);
            transition: opacity 0.3s ease-out, transform 0.5s ease-out, visibility 0.2s ease-out;
            text-align: left;
            display: flex; /* IMPORTANT: Use flex-direction column for children to stack */
            flex-direction: column;
        }

        /* Utility Dropdown (right-aligned, different style) */
        .piv-utility-wrapper .piv-dropdown-content {
            right: 0;
            left: auto; /* Overrides left: 0 */
            border-radius: 12px;
        }

        .piv-btn-cog {
            width: 25px;
            height: auto;
            filter: brightness(5);
        }
        .piv-utility-container.active .piv-utility-btn .piv-btn-cog {
            transform: rotate(180deg);
            transition: transform 0.5s ease;
        }

        .piv-submenu-title {
          cursor: default;
        }

        /* Menu Items */
        .piv-dropdown-content a, .piv-submenu-title {
            color: #333;
            padding: 14px 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 13px;
            border-radius: 6px;
            margin-bottom: 2px;
            white-space: nowrap;
        }

        .piv-dropdown-content a:hover .piv-icon,
        .piv-nested-submenu a:hover .piv-icon {
            color: #026d26;
        }

        .piv-dropdown-content a:hover,
        .piv-fullscreen-submenu a:hover,
        .piv-nested-submenu a:hover,
        .piv-submenu-title:hover {
            background-color: #00000021;
            color: #026d26;
        }

        /* Icon Styling */
        .piv-icon {
            width: 18px;
            text-align: center;
            margin-right: 10px;
            font-size: 14px;
            color: #2a3e5d;
            flex-shrink: 0;
        }

        /* Show the dropdown - Activated on hover */
        .piv-dropdown-item-container:hover .piv-dropdown-content {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        /* Arrow icon (main menu) */
        .piv-arrow {
            margin-left: 5px;
            font-size: 0.8em;
            transition: transform 0.2s ease;
        }

        /* Submenu arrow (points right) */
        .piv-arrow-right {
            margin-left: auto;
            font-size: 0.75em;
            opacity: 0.7;
        }

        /* Rotate arrow on hover */
        .piv-dropdown-item-container:hover .piv-arrow {
            transform: rotate(180deg);
        }

        /* ------------------------------------------------
            NESTED SUBMENU POSITIONING (Main Menu)
            ------------------------------------------------ */

        /* Nested Menu Wrapper (to hold the link and the side menu) */
        .piv-menu-wrapper {
            position: relative;
            /* Match the size of a standard menu item */
            width: 100%;
            display: block;
        }

        .piv-has-nested {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* The main link for the nested menu (it's a standard piv-menu-item but inside a wrapper) */
        .piv-menu-wrapper > .piv-menu-item {
             margin-bottom: 0; /* Remove margin-bottom so it aligns with the submenu */
        }

        /* Submenu container (appears next to parent) */
        .piv-nested-submenu {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            top: 0;
            /* Position to the RIGHT of the parent main menu item */
            left: 100%;
            background-color: #ffffff; /* Solid white background for the nested menu */
            box-shadow: 6px 8px 30px 0px rgb(0 0 0 / 20%);
            z-index: 100000001 !important; /* Higher than main menu content */
            border-radius: 12px;
            padding: 5px;
            border-bottom: 3px solid #2a3e5d;
            transform: translateX(-6px); /* Small offset for transition */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.2s ease-out;
            white-space: nowrap;
            display: flex;
            flex-direction: column;
        }

        /* The individual link items inside the nested submenu */
        .piv-nested-submenu > a.piv-menu-item.piv-submenu-item {
             /* Use margin-bottom again for the actual links */
             margin-bottom: 2px;
             color: #333; /* Ensure text color is right for white background */
        }

        /* Show submenu on hover of the wrapper */
        .piv-menu-wrapper:hover .piv-nested-submenu {
            visibility: visible;
            opacity: 1;
            transform: translateX(5px);
        }


        /* ------------------------------------------------
            NESTED SUBMENU POSITIONING
            ------------------------------------------------ */

        /* Nested Utility Menu Wrapper (for side positioning) */
        .piv-utility-menu-wrapper {
            position: relative;
            /* Match the size of a standard utility item */
            width: 100%;
            display: block;
        }

        /* Submenu container (appears next to parent) */
        .piv-fullscreen-submenu {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            top: 0;
            /* Position to the LEFT of the parent utility menu */
            right: 100%;
            background-color: #ffffff;
            box-shadow: -6px 8px 30px 0px rgb(0 0 0 / 20%);
            z-index: 100000001 !important; /* Higher than main menu content */
            border-radius: 12px;
            padding: 5px;
            border-bottom: 3px solid #2a3e5d;
            transform: translateX(10px); /* Small offset for transition */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.2s ease-out;
            white-space: nowrap;
            display: flex;
            flex-direction: column;
        }

        /* Show submenu on hover of the wrapper */
        .piv-utility-menu-wrapper:hover .piv-fullscreen-submenu {
            visibility: visible;
            opacity: 1;
            transform: translateX(-6px);
        }


        /* ===============================
          THEME PICKER ‚Äì DESIGN MODE
          =============================== */

        .piv-theme-popup {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -48%) scale(0.95);
          opacity: 0;
          transition: opacity 0.3s ease, transform 0.3s ease;
          user-select: none;
          background: #7d7d7db5;
          border-radius: 18px;
          padding: 20px 18px 16px;
          width: 520px;
          height: 380px;
          z-index: 1000000000;
          box-shadow: 0px 60px 50px rgb(0 0 0 / 43%);
          color: #e5e7eb;
          font-family: Inter, system-ui, sans-serif;
          backdrop-filter: blur(10px);
        }

        .piv-theme-popup.active {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
          user-select: auto;
        }

        .piv-color-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .piv-color-popup-header span{
          color: white;
          font-size: 20px;
        }

        .piv-color-close {
          position: absolute;
          top: 15px;
          right: 15px;
          color: #ffffffff;
          font-size: 24px;
          cursor: pointer;
        }

        .piv-theme-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 14px;
        }

        .piv-theme-card {
          background: #020617;
          border-radius: 12px;
          padding: 8px;
          cursor: pointer;
          transition: transform .2s ease, box-shadow .2s ease;
          text-align: center;
        }

        .piv-theme-card svg {
          width: 100%;
          border-radius: 8px;
        }

        .piv-theme-card span {
          display: block;
          margin-top: 6px;
          font-size: 12px;
          color: #cbd5f5;
        }

        .piv-theme-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 30px rgba(0,0,0,.4);
        }

        .piv-theme-footer {
          margin-top: 14px;
          display: flex;
          align-items: center;
          gap: 10px;
          font-size: 12px;
          color: #94a3b8;
        }

        .piv-color-input {
          width: 34px;
          height: 34px;
          border-radius: 50%;
          border: none;
          cursor: pointer;
        }

        /* ===============================
          THEME PICKER ‚Äì DESIGN MODE END
          =============================== */


        /* =======================================================
            FULL SCREEN MODE STYLES
            =======================================================
        */

        /* Hide specific PI Vision elements */
        .piv-fullscreen-active .c-header-container,
        .piv-fullscreen-active .c-display-header,
        .piv-fullscreen-active #sidebar-pane,
        .piv-fullscreen-active .k-splitbar,
        .piv-fullscreen-active #config-pane {
            display: none !important;
        }

        /* Resize PI Vision containers to fill the screen */
        .piv-fullscreen-active #shell-splitter-container > div:nth-of-type(3) {
              top: 0px !important;
              height: 100% !important;
              width: 100% !important;
              left: 0 !important;
           }

        .piv-fullscreen-active #footer-pane {
            top: unset !important;
            bottom: 0 !important;
            width: 100% !important;
        }

        .piv-fullscreen-active #display-splitter-container {
            height: 97% !important;
            width: 100% !important;
        }

        .piv-fullscreen-active #center-pane {
            width: 100% !important;
            height: 100% !important;
        }

        /* Ensure custom header stays visible and at the top */
        .piv-fullscreen-active #piv-custom-header {
            top: 0px !important;
        }

        /**** Other PI Vision Styles ****/

        #display-splitter-container, .t-border-layout-mode {
            border-radius: 10px !important;
        }

        .c-icon-zoom-control {
            background-color: rgb(0 55 11) !important;
            border: 1px solid rgba(230, 231, 232, .1) !important;
            border-radius: 10px !important;
           }

        /***** Sidebar Styles ******/
        #sidebar-pane tool-tabs ul.k-tabstrip-items {
            padding: .3em !important;
        }

        .k-tabstrip-left>.k-tabstrip-items-wrapper .k-item {
            border-radius: 10px !important;
        }

        #sidebar-pane tool-tabs>div>ul>li.k-item {
            background-color: transparent !important;
            border: 1px solid #091d3a !important;
            padding: 4px 0px;
        }

        #sidebar-pane tool-tabs>div>ul>li.k-item:hover {
            background-color: #091d3a96 !important;
        }

        #sidebar-pane tool-tabs>div>ul>li.k-item.k-active {
            background-color: #091d3a !important;
            padding: 40px 2px !important;
            transition: all .3s ease;
        }

        .c-pane-header {
          display: flex;
          justify-content: center !important;
          font-size: 26px !important;
          height: 50px !important;
          margin: 5px;
          border-radius: 10px;
        }

        #timebar-form {
          border: none !important;
        }

        .t-side-panel-bgcolor {
            border-radius: 10px !important;
        }

        .k-tabstrip-left>.k-content, .k-tabstrip-left>.k-tabstrip-content{
          border-radius: none !important;
        }

        #sidebar-pane tool-tabs.tool-tabs>div:not(.k-tabstrip-items-wrapper) {
          background: transparent !important;
          border: none;
        }

        .t-toolbar {
            border-radius: 10px;
            margin: 5px;
            padding: 5px;
        }

        .t-header {
            background-color: #2a3e5d !important;
        }

    `;

  // =======================================
  // PART 3: EXECUTION LOGIC
  // =======================================

  /* Target class/container */
  const TARGET_CONTAINER_SELECTOR = ".header-pane";

  /* Lien/view autoris√© */
  const ALLOWED_VIEW_HASHES = [
    /* Commun */
    "#/Displays/11134/Pipeline-Overview_KH-JORF",
    "#/Displays/10955/Etat-SHUNT-Globale",
    "#/Displays/11150/Vue-Globale-Supply-Chain",
    "#/Displays/305/Vue-Globale-Pipeline",
    "#/Displays/10953/Etat-Marche-Globale-Pipeline",
    "#/Displays/10949/Suivi-des-Batchs-Pipeline",
    "#/Displays/11149/Pipe-Consommation-Electrique",
    "#/Displays/10938/Tonnage",
    "#/Displays/11164/Heure-de-Marche_PIPE",

    /* Head Station */
    "#/Displays/11151/HS-Mainline-Overview",
    "#/Displays/10961/Vue-Operationnelle_HS",
    "#/Displays/11188/Feeders_Storage-Tanks_HS",
    "#/Displays/10947/HS-Pompe-Etanchite-(GSW)",
    "#/Displays/10947/Station-Tete-PERONI-(GSW)",
    "#/Displays/11156/HS-GSW",
    "#/Displays/11101/Etat-Simulation_Head-Station",
    "#/Displays/11157/Maintenance_HS-Train-A",
    "#/Displays/10928/Maintenance_HS-Train-B",
    "#/Displays/11158/Maintenance_HS-Reception",
    "#/Displays/11192/Controle-Energie_HS",

    /* Daoui */
    "#/Displays/11023/Daoui-overview",
    "#/Displays/11051/DAOUI-GSW",
    "#/Displays/621/Maintenance-DAOUI",
    "#/Displays/11163/DAOUI-Station_Overview",
    "#/Displays/10936/Station-DAOUI-Pompes-PERONI-(GSW)",
    "#/Displays/11203/Controle-Energie_DA",

    /* MEA */
    "#/Displays/10960/MEA-Overview",
    "#/Displays/11160/MEA-Feeder-Lines",

    /* Beni Amir */
    "#/Displays/11008/BA-Overview",
    "#/Displays/11155/BENI-AMIR_GSW",
    "#/Displays/10944/Maintenance-BENI-AMIR",
    "#/Displays/11154/Beni-Amir_Overview",
    "#/Displays/10946/Station-BENI-AMIR-Pompes_GSW",
    "#/Displays/11197/Controle-Energie_BA",

    /* PMS & Station Vannes */
    "#/Displays/11043/PMS-et-station-vanne",

    /* Terminal */
    "#/Displays/11038/Terminal-Overview",
  ];

  /**
   * Main function that runs on page load and on hash change (SPA navigation).
   */
  async function initializeMenu() {
    const currentHash = window.location.hash;
    const customHeader = document.getElementById("piv-custom-header");

    // --- VIEW FILTERING ---
    const isAllowed = ALLOWED_VIEW_HASHES.some((targetHash) =>
      currentHash.startsWith(targetHash)
    );

    if (!isAllowed) {
      // Remove the menu if the user navigates away from an allowed page
      if (customHeader) {
        customHeader.remove();
        location.reload();
      }
      console.log("Menu script skipped: Current view is not a target view.");
      return;
    }

    // Initialize Font awesome icons
    loadFontAwesome();
    // --- END VIEW FILTERING ---

    // If the menu already exists, only run the position observer and exit.
    if (customHeader) {
      return;
    }

    // 1. Inject Styles
    GM_addStyle(customMenuCSS);

    // 2. Wait for the Target Container to exist
    const targetContainer = await waitForElement(TARGET_CONTAINER_SELECTOR);

    // 3. Inject HTML
    targetContainer.insertAdjacentHTML("afterbegin", customMenuHTML);

    // Color brightness detection
    function isColorDark(hex) {
      const c = hex.replace("#", "");
      const r = parseInt(c.substr(0, 2), 16);
      const g = parseInt(c.substr(2, 2), 16);
      const b = parseInt(c.substr(4, 2), 16);

      // Perceived luminance
      const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
      return luminance < 140;
    }

    // Inject Color picker Popup
    function injectColorPickerPopup() {
      if (document.getElementById("piv-bg-color-popup")) return;

      const popupHTML = `
        <div id="piv-bg-color-popup" class="piv-theme-popup">
          <div class="piv-color-popup-header">
            <span>Couleur de fond</span>
            <i class="fa-solid fa-xmark piv-color-close"></i>
          </div>

          <div class="piv-theme-grid">
            <div class="piv-theme-card" data-color="#0f172a">
              <svg viewBox="0 0 120 70">
                <rect width="120" height="70" rx="6" fill="#0f172a"/>
                <rect x="8" y="10" width="40" height="6" rx="2" fill="#94a3b8"/>
                <rect x="8" y="22" width="60" height="6" rx="2" fill="#64748b"/>
                <rect x="8" y="34" width="80" height="6" rx="2" fill="#475569"/>
              </svg>
              <span>Sombre</span>
            </div>

            <div class="piv-theme-card" data-color="#1e293b">
              <svg viewBox="0 0 120 70">
                <rect width="120" height="70" rx="6" fill="#1e293b"/>
                <rect x="8" y="10" width="40" height="6" rx="2" fill="#cbd5e1"/>
                <rect x="8" y="22" width="60" height="6" rx="2" fill="#94a3b8"/>
                <rect x="8" y="34" width="80" height="6" rx="2" fill="#64748b"/>
              </svg>
              <span>Ardoise</span>
            </div>

            <div class="piv-theme-card" data-color="#f3f4f6">
              <svg viewBox="0 0 120 70">
                <rect width="120" height="70" rx="6" fill="#f3f4f6"/>
                <rect x="8" y="10" width="40" height="6" rx="2" fill="#374151"/>
                <rect x="8" y="22" width="60" height="6" rx="2" fill="#1f2937"/>
                <rect x="8" y="34" width="80" height="6" rx="2" fill="#111827"/>
              </svg>
              <span>Clair</span>
            </div>
          </div>

          <div class="piv-theme-footer">
            <input type="color" class="piv-color-input" />
            <span>Couleur personnalis√©e</span>
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML("beforeend", popupHTML);
    }

    function applyPIBackgroundColor(color) {
      const STYLE_ID = "piv-bg-color-style";

      let styleEl = document.getElementById(STYLE_ID);

      if (!styleEl) {
        styleEl = document.createElement("style");
        styleEl.id = STYLE_ID;
        document.head.appendChild(styleEl);
      }

      // Adjust text colors based on background brightness
      const dark = isColorDark(color);
      const textColor = dark ? "#ffffffcc" : "#000000cc";

      styleEl.textContent = `
        /* PIV Custom Background Override */
        #viewport,
        #piv-custom-header,
        #timebar-pane,
        #shell-splitter-container>.k-pane,
        .header-pane,
        .t-header-gradient,
        .t-header,
        .k-splitbar,
        #shell-splitter-container .c-splitter-disabled,
        .t-display-header,
        .c-splitter-disabled,
        .t-pane-header-color,
        .tool-tabs {
          background: ${color} !important;
          color: ${textColor} !important;
        }
      `;
    }

    // Inject Secondary Logo
    async function injectSecondaryLogo() {
      const logoContainer = await waitForElement(".c-app-logo");

      if (logoContainer.querySelector(".piv-secondary-logo")) return;

      const wrapper = document.createElement("div");
      wrapper.className = "piv-secondary-logo";
      wrapper.innerHTML = secondaryLogoSVG;

      // Insert as FIRST child
      logoContainer.insertBefore(wrapper, logoContainer.firstChild);
    }

    // Inject Aveva logo
    async function injectSidebarLogo() {
      const sidebar = await waitForElement("#sidebar-pane");

      if (sidebar.querySelector(".piv-sidebar-logo")) return;

      const wrapper = document.createElement("div");
      wrapper.className = "piv-sidebar-logo";
      wrapper.innerHTML = sidebarLogoSVG;

      // Insert as FIRST child
      sidebar.insertBefore(wrapper, sidebar.firstChild);
    }

    // Inject live date and time
    async function injectLiveDate() {
      const header = await waitForElement(".c-header");

      if (header.querySelector(".piv-live-date")) return;

      const dateDiv = document.createElement("div");
      dateDiv.className = "piv-live-date";

      const update = () => {
        dateDiv.textContent = formatFrenchDateTime(new Date());
      };

      update();
      setInterval(update, 1000);

      // Insert as SECOND child
      const secondChild = header.children[1] || null;
      header.insertBefore(dateDiv, secondChild);
    }

    injectSidebarLogo();
    injectLiveDate();
    injectSecondaryLogo();

    // 5. Attach Hover (Active State) Listeners
    const dropdownContainers = document.querySelectorAll(
      ".piv-dropdown-item-container"
    );
    dropdownContainers.forEach((container) => {
      container.addEventListener("mouseenter", () => {
        container.classList.add("active");
      });
      container.addEventListener("mouseleave", () => {
        container.classList.remove("active");
      });
    });

    // 6. Attach Click Listeners for Navigation Links (Main and Nested)
    // Select all links with the .piv-menu-item class (main dropdown links AND nested submenu links)
    const piVisionLinks = document.querySelectorAll(".piv-menu-item");
    piVisionLinks.forEach((item) => {
      item.addEventListener("click", function (event) {
        const targetHash = item.getAttribute("data-hash");

        // If it's a menu-wrapper link (which has no hash), don't prevent default and let it bubble up
        if (!targetHash) {
          // This is the link that opens the nested submenu, so we do nothing.
          return;
        }

        event.preventDefault();

        // Use window.location.hash to navigate within PI Vision
        window.location.hash = targetHash;
        console.log(`Navigating to PI Vision Display: ${targetHash}`);

        // Close the main menu after navigation
        const mainContainer = item.closest(".piv-dropdown-item-container");
        if (mainContainer) {
          mainContainer.classList.remove("active");
        }
      });
    });

    // 7. Attach Click Listeners for Utility Dropdown (No change in logic)
    const utilityItems = document.querySelectorAll(".piv-utility-item");
    const header = document.getElementById("piv-custom-header");

    utilityItems.forEach((item) => {
      item.addEventListener("click", function (event) {
        event.preventDefault();

        const action = item.getAttribute("data-action");
        const mode = item.getAttribute("data-mode");

        console.log(`Utility action triggered: ${action} (Mode: ${mode})`);

        // Cache icon + label once
        const icon = item.querySelector("i");
        const label = item.querySelector("span");

        switch (action) {
          case "hide-navbar": {
            // Toggle minimized state
            const isMinimized = header.classList.toggle("piv-minimized");

            if (icon && label) {
              if (isMinimized) {
                label.textContent = "Montrer la Barre";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
              } else {
                label.textContent = "Masquer la Barre";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
              }
            }

            break;
          }

          case "open-bg-color-picker": {
            injectColorPickerPopup();

            const popup = document.getElementById("piv-bg-color-popup");
            popup.classList.add("active");

            popup.querySelector(".piv-color-close").onclick = () => {
              popup.classList.remove("active");
            };

            popup.querySelectorAll("[data-color]").forEach((btn) => {
              btn.onclick = () => {
                applyPIBackgroundColor(btn.dataset.color);
              };
            });

            popup.querySelector(".piv-color-input").oninput = (e) => {
              applyPIBackgroundColor(e.target.value);
            };

            break;
          }

          case "set-fullscreen-mode":
            toggleFullScreenMode(mode);

            // Close menu unless it's a placeholder action
            if (mode !== "custom-select") {
              item
                .closest(".piv-dropdown-item-container")
                ?.classList.remove("active");
            }
            return;

          case "refresh-page":
            window.location.reload();
            return;
        }

        // Close utility menu for standard actions
        item
          .closest(".piv-dropdown-item-container")
          ?.classList.remove("active");
      });
    });

    console.log(
      "%c‚úÖ Dynamic & Responsive PI Vision Navbar Initialized!",
      "color: green; font-size: 14px; font-weight: bold;"
    );
  }

  // =================================================================
  // START UP LOGIC (SPA handling)
  // =================================================================

  // 1. Initial run on page load
  initializeMenu();

  // 2. Handle PI Vision's Single Page Application (SPA) navigation
  window.addEventListener("hashchange", initializeMenu, false);
})();
